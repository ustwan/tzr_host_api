# ü§ñ –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è –±–æ—Ç–æ–≤

## üìä –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚ùå **PvE –∏–≥—Ä–æ–∫–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –±–æ—Ç—ã** (–¥–∞–∂–µ –µ—Å–ª–∏ –∏–≥—Ä–∞—é—Ç –≤—Ä—É—á–Ω—É—é)
2. ‚ùå `short_interval_sec = 1.0` —Å–µ–∫ ‚Äî **—Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø–æ—Ä–æ–≥**
3. ‚ùå –í—ã—Å–æ–∫–∏–π —à—Ç—Ä–∞—Ñ –∑–∞ PvE-—Ñ–æ–∫—É—Å (`w_pve_penalty = 0.15`)
4. ‚ùå –ù–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ **–¥–æ–ª–≥–∏—Ö —Å–µ—Å—Å–∏–π –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤** (3+ —á–∞—Å–∞)

---

## ‚úÖ –ù–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ (–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):

### **–ë–û–¢ = –∏–≥—Ä–æ–∫ –∫–æ—Ç–æ—Ä—ã–π:**

1. **–°–≤–µ—Ä—Ö–∫–æ—Ä–æ—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:** 0.05-0.5 —Å–µ–∫ –º–µ–∂–¥—É –±–æ—è–º–∏
2. **–î–æ–ª–≥–∏–µ —Å–µ—Å—Å–∏–∏ –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤:** 3+ —á–∞—Å–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ —Ñ–∞—Ä–º–∞
3. **–ù–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞—É–∑:** –¥–∞–∂–µ –≤ —Ç—É–∞–ª–µ—Ç –Ω–µ –æ—Ç—Ö–æ–¥–∏—Ç

### **–ù–ï –ë–û–¢ = PvE –∏–≥—Ä–æ–∫:**

- –ú–æ–∂–µ—Ç —Ñ–∞—Ä–º–∏—Ç—å 100+ –±–æ–µ–≤
- –ú–æ–∂–µ—Ç –∏–º–µ—Ç—å SR > 95%
- –ú–æ–∂–µ—Ç —É–±–∏–≤–∞—Ç—å –º–Ω–æ–≥–æ –º–æ–Ω—Å—Ç—Ä–æ–≤
- **–ù–û** –¥–µ–ª–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ä—ã–≤—ã (5-15 –º–∏–Ω—É—Ç)

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```python
# –ë–´–õ–û:
short_interval_sec: float = 1.0             # —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –ø–æ—Ä–æ–≥
short_interval_streak_high: int = 20        # —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ
w_pve_penalty: float = 0.15                 # —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π —à—Ç—Ä–∞—Ñ
w_short_intervals: float = 0.25             # –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

# –°–¢–ê–õ–û:
short_interval_sec: float = 0.5             # —Ç–æ–ª—å–∫–æ –±–æ—Ç—ã —Ç–∞–∫ –±—ã—Å—Ç—Ä–æ
short_interval_streak_high: int = 50        # —Å–µ—Ä–∏—è 50+ –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
w_pve_penalty: float = 0.05                 # —Å–Ω–∏–∂–µ–Ω —à—Ç—Ä–∞—Ñ –∑–∞ PvE (–æ–±—ã—á–Ω—ã–µ –∏–≥—Ä–æ–∫–∏ —Ç–æ–∂–µ —Ñ–∞—Ä–º—è—Ç)
w_short_intervals: float = 0.35             # —É–≤–µ–ª–∏—á–µ–Ω –≤–µ—Å –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
w_long_session_no_breaks: float = 0.30      # –ù–û–í–´–ô: –≤–µ—Å –¥–ª—è —Å–µ—Å—Å–∏–π –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤
```

---

## üÜï –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:

### 1. **–ê–Ω–∞–ª–∏–∑ –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤:**

```python
# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π 3+ —á–∞—Å–∞ –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤ > 5 –º–∏–Ω—É—Ç
def detect_marathon_sessions(intervals: List[float]) -> Dict:
    """
    –ë–æ—Ç—ã –¥–µ–ª–∞—é—Ç 3+ —á–∞—Å–∞ –±–æ–µ–≤ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ < 5 –º–∏–Ω—É—Ç
    –õ—é–¥–∏ –¥–µ–ª–∞—é—Ç –ø–µ—Ä–µ—Ä—ã–≤—ã: —Ç—É–∞–ª–µ—Ç, –µ–¥–∞, –æ—Ç–¥—ã—Ö
    """
    marathon_sessions = []
    current_session_duration = 0
    current_session_battles = 0
    
    for interval in intervals:
        if interval <= 300:  # <= 5 –º–∏–Ω—É—Ç
            current_session_duration += interval
            current_session_battles += 1
        else:  # –ø–µ—Ä–µ—Ä—ã–≤ > 5 –º–∏–Ω—É—Ç
            if current_session_duration >= 3 * 3600:  # 3 —á–∞—Å–∞
                marathon_sessions.append({
                    'duration_hours': current_session_duration / 3600,
                    'battles': current_session_battles
                })
            current_session_duration = 0
            current_session_battles = 0
    
    return {
        'marathon_count': len(marathon_sessions),
        'longest_session_hours': max([s['duration_hours'] for s in marathon_sessions], default=0),
        'total_marathon_battles': sum([s['battles'] for s in marathon_sessions], default=0)
    }
```

### 2. **–ê–Ω–∞–ª–∏–∑ –º–∏–∫—Ä–æ-–∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (0.05-0.5 —Å–µ–∫):**

```python
# –¢–æ–ª—å–∫–æ –±–æ—Ç—ã –¥–µ–ª–∞—é—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã < 0.5 —Å–µ–∫
ultra_short_intervals = [i for i in intervals if i <= 0.5]
ultra_short_ratio = len(ultra_short_intervals) / len(intervals)

if ultra_short_ratio > 0.3:  # 30%+ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ < 0.5 —Å–µ–∫
    reasons.append(f"ü§ñ –ë–æ—Ç–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã < 0.5 —Å–µ–∫ ({ultra_short_ratio:.1%})")
    bot_score += 0.4  # —Å–∏–ª—å–Ω—ã–π –±—É—Å—Ç
```

### 3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞:**

```python
# –ü–†–ê–í–ò–õ–û: PvE –∏–≥—Ä–æ–∫ ‚â† –±–æ—Ç
# - PvE –∏–≥—Ä–æ–∫: –≤—ã—Å–æ–∫–∏–π PvE KPM, –¥–µ–ª–∞–µ—Ç –ø–µ—Ä–µ—Ä—ã–≤—ã
# - –ë–æ—Ç: –≤—ã—Å–æ–∫–∏–π PvE KPM, –ù–ï–¢ –ø–µ—Ä–µ—Ä—ã–≤–æ–≤, —Å–≤–µ—Ä—Ö–∫–æ—Ä–æ—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

is_pve_focused = (kpm_pve > 10 and kpm_pvp < 0.5)
has_natural_breaks = (max_gap_hours > 0.5)  # –µ—Å—Ç—å –ø–µ—Ä–µ—Ä—ã–≤—ã > 30 –º–∏–Ω
has_ultra_short = (ultra_short_ratio > 0.2)  # 20%+ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ < 0.5 —Å–µ–∫
has_marathons = (marathon_count > 0)         # –µ—Å—Ç—å —Å–µ—Å—Å–∏–∏ 3+ —á–∞—Å–∞

if is_pve_focused:
    if has_natural_breaks and not has_ultra_short:
        # –û–±—ã—á–Ω—ã–π PvE –∏–≥—Ä–æ–∫ - –°–ù–ò–ó–ò–¢–¨ score
        suspicion_score -= 0.3
        reasons.append("‚úÖ PvE –∏–≥—Ä–æ–∫ —Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏")
    elif has_marathons and has_ultra_short:
        # –ë–û–¢ - –ü–û–í–´–°–ò–¢–¨ score
        suspicion_score += 0.4
        reasons.append("ü§ñ PvE –±–æ—Ç: –º–∞—Ä–∞—Ñ–æ–Ω—ã + –º–∏–∫—Ä–æ-–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã")
```

---

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç:

### **–ë–´–õ–û:**
```
–ì–µ–ª—å–º–∞–Ω: 155 –±–æ–µ–≤, SR=100%, PvE KPM=43.6
‚Üí is_bot=true, score=0.85
‚Üí reasons: "PvP < 5%", "KPM > 15", "SR > 95%"
```

### **–°–¢–ê–ù–ï–¢:**
```
–ì–µ–ª—å–º–∞–Ω: 155 –±–æ–µ–≤, SR=100%, PvE KPM=43.6
‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤...
‚Üí ultra_short_ratio = 0.05 (—Ç–æ–ª—å–∫–æ 5% < 0.5 —Å–µ–∫)
‚Üí max_gap_hours = 2.5 (–µ—Å—Ç—å –ø–µ—Ä–µ—Ä—ã–≤—ã)
‚Üí marathon_count = 0 (–Ω–µ—Ç —Å–µ—Å—Å–∏–π 3+ —á–∞—Å–∞)
‚Üí is_bot=false, score=0.35
‚Üí reasons: "‚úÖ PvE –∏–≥—Ä–æ–∫ —Å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ä—ã–≤–∞–º–∏"
```

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û–±—ã—á–Ω—ã–π –∏–≥—Ä–æ–∫ | –ë–û–¢ |
|----------|---------------|-----|
| –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã < 0.5 —Å–µ–∫ | < 10% | > 30% |
| –ü–µ—Ä–µ—Ä—ã–≤—ã > 30 –º–∏–Ω | –ï—Å—Ç—å | –ù–µ—Ç |
| –°–µ—Å—Å–∏–∏ –±–µ–∑ –ø–∞—É–∑ | < 2 —á–∞—Å–∞ | 3+ —á–∞—Å–∞ |
| PvE KPM | –õ—é–±–æ–π | –õ—é–±–æ–π |
| PvP –¥–æ–ª—è | –õ—é–±–∞—è | –õ—é–±–∞—è |

**–ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ:** –ù–ï —Å–∞–º–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∞ **–ü–ê–¢–¢–ï–†–ù –ü–û–í–ï–î–ï–ù–ò–Ø**!





