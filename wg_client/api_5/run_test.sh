#!/usr/bin/env bash
# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ API 5 –ª–æ–∫–∞–ª—å–Ω–æ

echo "üöÄ API 5 - Shop Parser: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫"
echo "=========================================="

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [[ ! -d "venv" ]]; then
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    python3 -m venv venv
fi

source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -q -r requirements.txt

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
echo ""
echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
pytest tests/ -v

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
if [[ $? -eq 0 ]]; then
    echo ""
    echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!"
    echo ""
    echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ API –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
    echo "  python app/main.py"
    echo ""
    echo "–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤:"
    echo "  python shop_workers/run_workers.py"
else
    echo ""
    echo "‚ùå –¢–µ—Å—Ç—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å"
    exit 1
fi


