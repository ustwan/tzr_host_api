# API 5 - Implementation Guide (–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-11  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í –ö –ü–†–û–î–ê–ö–®–ï–ù–£

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è](#–æ–±—â–∞—è-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–æ—Ç–æ–≤](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-–±–æ—Ç–æ–≤)
4. [–ü—Ä–æ—Ç–æ–∫–æ–ª –º–∞–≥–∞–∑–∏–Ω–∞](#–ø—Ä–æ—Ç–æ–∫–æ–ª-–º–∞–≥–∞–∑–∏–Ω–∞)
5. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
6. [–ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ](#–∑–∞–ø—É—Å–∫-–∏-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ)
7. [API Endpoints](#api-endpoints)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
10. [FAQ](#faq)

---

## –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

API 5 ‚Äî —Å–µ—Ä–≤–∏—Å –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏–≥—Ä–æ–≤—ã—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –≤ —Ç—Ä—ë—Ö –≥–æ—Ä–æ–¥–∞—Ö:
- **Moscow** (–ú–æ—Å–∫–≤–∞)
- **Oasis** (–û–∞–∑–∏—Å)
- **Neva** (–ù–µ–≤–∞)

### –ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å

**Shop Workers –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¢–£ –ñ–ï –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á—Ç–æ –∏ XML Workers!**

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ –∂–µ –±–æ—Ç—ã `Sova`
- ‚úÖ –¢–µ –∂–µ `LOGIN_KEY` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –¢–æ –∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `185.92.72.18:5190`
- ‚úÖ –¢–∞ –∂–µ —Å—Ö–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `<LOGIN ... />`

**–†–∞–∑–ª–∏—á–∏–µ:** –í–º–µ—Å—Ç–æ –∫–æ–º–∞–Ω–¥—ã `//blook {battle_id}` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `<SH c="..." />`

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     API 5 - Shop Parser                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ   Moscow     ‚îÇ  ‚îÇ    Oasis     ‚îÇ  ‚îÇ     Neva     ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ   Worker     ‚îÇ  ‚îÇ   Worker     ‚îÇ  ‚îÇ   Worker     ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  (Sova Bot)  ‚îÇ  ‚îÇ  (Sova Bot)  ‚îÇ  ‚îÇ  (Sova Bot)  ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ               ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                            ‚îÇ                                  ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îÇ
‚îÇ                    ‚îÇ Game Server    ‚îÇ                        ‚îÇ
‚îÇ                    ‚îÇ 185.92.72.18   ‚îÇ                        ‚îÇ
‚îÇ                    ‚îÇ :5190          ‚îÇ                        ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îÇ
‚îÇ                            ‚îÇ                                  ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ         ‚îÇ                                      ‚îÇ              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ  FastAPI    ‚îÇ                      ‚îÇ  PostgreSQL  ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  :8085      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  api5_shop   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  (API)      ‚îÇ                      ‚îÇ  :6013       ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ    Traefik     ‚îÇ
                    ‚îÇ /api/shop/*    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Clean Architecture

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Clean Architecture (–∫–∞–∫ API 4):

```
api_5/
‚îú‚îÄ‚îÄ domain/              # –°—É—â–Ω–æ—Å—Ç–∏ (Shop, Item, Snapshot)
‚îú‚îÄ‚îÄ usecases/            # –ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ infrastructure/      # –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (DB, Socket)
‚îú‚îÄ‚îÄ interfaces/          # HTTP API (FastAPI)
‚îî‚îÄ‚îÄ parsers/             # XML –ø–∞—Ä—Å–µ—Ä—ã
```

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–æ—Ç–æ–≤

### –°—Ö–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–∏–∑ XML Workers)

```python
# 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
sock = socket.connect(("185.92.72.18", 5190))

# 2. –û—Ç–ø—Ä–∞–≤–∫–∞ LOGIN
login_xml = '''
<LOGIN v3="10.20.30.40" lang="ru" v2="4875537" v="108" 
       p="{LOGIN_KEY}" l="{LOGIN_NAME}" />\x00
'''
sock.sendall(login_xml.encode('utf-8'))

# 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞
response = sock.recv(8192)

# 4. –û—Ç–ø—Ä–∞–≤–∫–∞ GETME
sock.sendall("<GETME />\x00".encode('utf-8'))

# 5. –û–∂–∏–¥–∞–Ω–∏–µ MYPARAM
time.sleep(1.5)

# ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–¢–µ –∂–µ —á—Ç–æ –≤ XML Workers:**

```bash
# Moscow
SOVA_MOSCOW_LOGIN=Sova
SOVA_MOSCOW_KEY=<–∫–ª—é—á –∏–∑ XML Workers>

# Oasis
SOVA_OASIS_LOGIN=Sova
SOVA_OASIS_KEY=<–∫–ª—é—á –∏–∑ XML Workers>

# Neva
SOVA_NEVA_LOGIN=Sova
SOVA_NEVA_KEY=<–∫–ª—é—á –∏–∑ XML Workers>
```

### Keep-alive –ø–∏–Ω–≥–∏

```python
# –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
sock.sendall("<N />\x00".encode('utf-8'))
```

---

## –ü—Ä–æ—Ç–æ–∫–æ–ª –º–∞–≥–∞–∑–∏–Ω–∞

### –ó–∞–ø—Ä–æ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```xml
<SH c="k" s="" p="0" />
```

–ì–¥–µ:
- `c` ‚Äî –∫–∞—Ç–µ–≥–æ—Ä–∏—è (k, p, v, h, e, x, g, m, a, i, c, l, t, b, f, q, u, n, j, d, s, y, r, z, 0, 1)
- `s` ‚Äî —Ñ–∏–ª—å—Ç—Ä (–ø—É—Å—Ç–æ–π –∏–ª–∏ `name:...,type:...` –¥–ª—è –≥—Ä—É–ø–ø)
- `p` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (—Å 0)

### –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞

```xml
<SH c="k" s="" p="0" m="10">
  <O id="123" txt="Sword" cost="100" ... />
  <O id="124" txt="Knife" cost="50" ... />
  ...
</SH>
```

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è

–°—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–±–∏—Ä–∞—é—Ç—Å—è `p=0,1,2,...` –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ **–Ω–µ –Ω–∞—á–Ω—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è —Ç–æ–≤–∞—Ä—ã**.

–ê–ª–≥–æ—Ä–∏—Ç–º:
```python
page = 0
seen_ids = set()

while True:
    xml = client.fetch_shop_category("k", page)
    items = parse_items(xml)
    
    current_ids = {item.id for item in items}
    
    if current_ids.issubset(seen_ids):
        break  # –ü–æ–≤—Ç–æ—Ä ‚Üí –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    
    seen_ids.update(current_ids)
    page += 1
```

### –†–∞—Å–∫—Ä—ã—Ç–∏–µ –≥—Ä—É–ø–ø

–ï—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç —Å `count="N"`:

```xml
<O txt="Glock 18" name="b2-p4" type="2.21" count="13" />
```

–≠—Ç–æ **–≥—Ä—É–ø–ø–∞ —Ç–æ–≤–∞—Ä–æ–≤**. –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å–æ–º:

```xml
<SH c="p" s="name:b2-p4,type:2.21" p="0" />
```

–í–Ω—É—Ç—Ä–∏ –≥—Ä—É–ø–ø—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **8 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ**.

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ (PostgreSQL 15)

**7 —Ç–∞–±–ª–∏—Ü:**

1. **shops** ‚Äî –º–∞–≥–∞–∑–∏–Ω—ã (moscow, oasis, neva)
2. **item_templates** ‚Äî —à–∞–±–ª–æ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤
3. **shop_items** ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤
4. **snapshots** ‚Äî —Å–Ω–∏–º–∫–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤
5. **snapshot_items** ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∫ —Å–Ω–∏–º–∫–∞–º
6. **item_changes** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
7. **bot_sessions** ‚Äî —Å–µ—Å—Å–∏–∏ –±–æ—Ç–æ–≤

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**JSONB –ø–æ–ª—è:**
- `damage` ‚Äî `[{type: "S", min: 2, max: 6}, ...]`
- `protection` ‚Äî `[{type: "S", min: 7, max: 16}, ...]`
- `attack_modes` ‚Äî `[{type: 2, od: 3}, ...]`
- `requirements` ‚Äî `{level: 6, strength: 14, ...}`
- `bonuses` ‚Äî `{int: 4, str: 2}`

**–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:**
- `piercing="500"` ‚Üí `5.0%`
- `put_day="1749579438"` ‚Üí `TIMESTAMP`
- `st="G,H"` ‚Üí –æ–¥–Ω–æ—Ä—É—á–Ω—ã–π, `st="GH"` ‚Üí –¥–≤—É—Ä—É—á–Ω—ã–π

### –ò–Ω–¥–µ–∫—Å—ã

```sql
-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
CREATE INDEX ON shop_items(shop_id);
CREATE INDEX ON shop_items(template_id);
CREATE INDEX ON shop_items(price);
CREATE INDEX ON shop_items(added_at);

-- –°–Ω–∏–º–∫–∏
CREATE INDEX ON snapshots(shop_id, created_at DESC);
CREATE INDEX ON snapshot_items(snapshot_id);
```

---

## –ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
cd /Users/ii/Documents/code/WG_HUB/wg_client/api_5

# –¢–µ—Å—Ç—ã
./run_test.sh

# API
python app/main.py
# ‚Üí http://localhost:8085/docs
```

### 2. Docker (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

```bash
cd /Users/ii/Documents/code/WG_HUB/wg_client

# –ó–∞–ø—É—Å–∫ API 5 —Å –ë–î
bash tools/ctl.sh api5-up-db

# –õ–æ–≥–∏
bash tools/ctl.sh api5-logs

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
bash tools/ctl.sh api5-restart

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
bash tools/ctl.sh api5-down
```

### 3. –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤

**–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `SOVA_*_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (—Ç–µ –∂–µ —á—Ç–æ –≤ XML Workers)!

```bash
# –í—Å–µ 3 –≤–æ—Ä–∫–µ—Ä–∞
python shop_workers/run_workers.py

# –ò–ª–∏ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
python shop_workers/moscow_worker.py &
python shop_workers/oasis_worker.py &
python shop_workers/neva_worker.py &
```

### 4. –ß–µ—Ä–µ–∑ Docker Compose

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä—ã –≤ `HOST_API_SERVICE_SHOP_API.yml` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å XML Workers).

---

## API Endpoints

### Health & Service (3)

```bash
GET /healthz                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
GET /shop/health                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
GET /db/health                  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
```

### Items (3)

```bash
GET /items/list                 # –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
  ?shop_code=moscow             # –§–∏–ª—å—Ç—Ä –ø–æ –º–∞–≥–∞–∑–∏–Ω—É
  &page=1                       # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
  &limit=100                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ

GET /items/{id}                 # –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞
GET /items/search               # –ü–æ–∏—Å–∫ (TODO)
```

### Snapshots (2)

```bash
GET /snapshots/list             # –°–ø–∏—Å–æ–∫ —Å–Ω–∏–º–∫–æ–≤
  ?shop_code=moscow

GET /snapshots/latest           # –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–Ω–∏–º–æ–∫
  ?shop_code=moscow

GET /snapshots/{id}/diff        # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ (TODO)
```

### Admin (2)

```bash
POST /admin/snapshot/trigger    # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–∏–º–æ–∫ –≤—Ä—É—á–Ω—É—é
  ?shop_code=moscow

GET /admin/bots/status          # –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –±–æ—Ç–æ–≤
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã

```bash
cd api_5
pytest tests/ -v

# –¢–æ–ª—å–∫–æ –ø–∞—Ä—Å–µ—Ä—ã
pytest tests/test_shop_parser.py -v

# –¢–æ–ª—å–∫–æ use cases
pytest tests/test_usecases.py -v
```

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

**20+ unit —Ç–µ—Å—Ç–æ–≤:**
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —É—Ä–æ–Ω–∞ (S2-6, E3-7)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞—â–∏—Ç—ã (S7-16, O1-5)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∂–∏–º–æ–≤ –∞—Ç–∞–∫–∏
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –ø–∏—Å—Ç–æ–ª–µ—Ç–∞, –±—Ä–æ–Ω–∏
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- ‚úÖ Use cases —Å –º–æ–∫–∞–º–∏

### Integration —Ç–µ—Å—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∏–≥—Ä–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É)
pytest tests/test_integration.py -v
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤

```bash
# –ß–µ—Ä–µ–∑ Docker
bash tools/ctl.sh api5-logs

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker logs -f host-api-service-api_5-1
```

### –°—Ç–∞—Ç—É—Å –±–æ—Ç–æ–≤

```bash
curl http://localhost:8085/admin/bots/status
```

–û—Ç–≤–µ—Ç:
```json
{
  "bots": [
    {
      "shop_code": "moscow",
      "bot_login": "Sova",
      "authenticated": true,
      "session_id": "abc12345...",
      "last_activity": "2025-10-11T12:30:00"
    },
    ...
  ]
}
```

### Healthcheck

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π healthcheck –≤ Docker
docker ps | grep api_5
# ‚Üí healthy (–µ—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç)

# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8085/healthz
curl http://localhost:8085/shop/health
curl http://localhost:8085/db/health
```

---

## FAQ

### Q: –ö–∞–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω—É–∂–Ω—ã?

**A:** –¢–µ –∂–µ —á—Ç–æ –≤ XML Workers:

```bash
# –ë–æ—Ç—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
SOVA_MOSCOW_KEY=<–≤–∞—à –∫–ª—é—á>
SOVA_OASIS_KEY=<–≤–∞—à –∫–ª—é—á>
SOVA_NEVA_KEY=<–≤–∞—à –∫–ª—é—á>

# –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –¥–µ—Ñ–æ–ª—Ç—ã)
DB_API5_TEST_NAME=api5_shop
DB_API5_TEST_USER=api5_user
DB_API5_TEST_PASSWORD=api5_pass
```

### Q: –ö–∞–∫ —á–∞—Å—Ç–æ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–Ω–∏–º–∫–∏?

**A:** –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞–∂–¥—ã–π —á–∞—Å (`SNAPSHOT_INTERVAL=3600`).

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:
```bash
export SNAPSHOT_INTERVAL=1800  # 30 –º–∏–Ω—É—Ç
```

### Q: –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –≤–æ—Ä–∫–µ—Ä?

**A:** –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å Oasis worker
export SOVA_OASIS_ENABLED=false

# –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
export SOVA_OASIS_ENABLED=true
```

### Q: –°–∫–æ–ª—å–∫–æ —Ä–µ—Å—É—Ä—Å–æ–≤ —Ç—Ä–µ–±—É–µ—Ç—Å—è?

**A:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:
- **CPU:** 1-2 —è–¥—Ä–∞
- **RAM:** 1-2 GB
- **Disk:** 50 GB (–∑–∞–ø–∞—Å –Ω–∞ –≥–æ–¥)
- **–°–µ—Ç—å:** –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ —Ç–æ–π –∂–µ –º–∞—à–∏–Ω–µ —á—Ç–æ API 4?

**A:** ‚úÖ –î–∞! API 5 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –ë–î –∏ –ø–æ—Ä—Ç—ã, –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –¥—Ä—É–≥–∏–º–∏ API.

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –±–æ—Ç –æ—Ç–∫–ª—é—á–∏–ª—Å—è?

**A:** –í–æ—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (`RECONNECT_DELAY=5`).

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
curl http://localhost:8085/admin/bots/status
```

### Q: –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ Moscow?

**A:**
```bash
curl "http://localhost:8085/items/list?shop_code=moscow&limit=10"
```

### Q: –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–Ω–∏–º–æ–∫ –≤—Ä—É—á–Ω—É—é?

**A:**
```bash
curl -X POST "http://localhost:8085/admin/snapshot/trigger?shop_code=moscow"
```

### Q: –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–Ω–∏–º–∫–∏?

**A:** –í –ë–î `api5_shop`, —Ç–∞–±–ª–∏—Ü–∞ `snapshots`. –¢–æ–≤–∞—Ä—ã –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `snapshot_items`.

### Q: –ú–æ–∂–Ω–æ –ª–∏ —Å—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–∞ —Å–Ω–∏–º–∫–∞?

**A:** ‚úÖ –î–∞ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ):
```bash
GET /snapshots/{id}/diff
```

### Q: –ö–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?

**A:** –í—Å–µ 27 –∫–∞—Ç–µ–≥–æ—Ä–∏–π:

**–û—Ä—É–∂–∏–µ:** k, p, v, w, e, x, g, m, a, i  
**–û–¥–µ–∂–¥–∞:** h, c, l, t, b, f, q  
**–ü—Ä–æ—á–µ–µ:** u, n, j, d, s, y, r, z, 0, 1

### Q: –ö–∞–∫ —É–∑–Ω–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–Ω–∏–º–æ–∫?

**A:**
```bash
curl "http://localhost:8085/snapshots/latest?shop_code=moscow"
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ä—É–∂–∏—è –≤ Moscow

```bash
# –í—Å–µ —Ç–æ–≤–∞—Ä—ã Moscow
curl "http://localhost:8085/items/list?shop_code=moscow&limit=100"
```

### 2. –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞

```bash
curl "http://localhost:8085/items/79469641"
```

–û—Ç–≤–µ—Ç:
```json
{
  "id": 79469641,
  "txt": "Butterfly knife",
  "price": 4.0,
  "current_quality": 125,
  "max_quality": 125,
  "shop_id": 1,
  "template_id": 42,
  "owner": null
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–æ—Ç–æ–≤

```bash
curl "http://localhost:8085/admin/bots/status"
```

### 4. –°–æ–∑–¥–∞—Ç—å —Å–Ω–∏–º–æ–∫ –≤—Ä—É—á–Ω—É—é

```bash
curl -X POST "http://localhost:8085/admin/snapshot/trigger?shop_code=moscow"
```

### 5. Swagger UI

```bash
open http://localhost:8085/docs
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
wg_client/api_5/
‚îú‚îÄ‚îÄ README.md                               # –û—Å–Ω–æ–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ QUICK_START.md                          # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îú‚îÄ‚îÄ API5_IMPLEMENTATION_GUIDE.md            # –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ STATUS.md                               # –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ Dockerfile                              # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ requirements.txt                        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ pytest.ini                              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ run_test.sh                             # –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ config.py                           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ main.py                             # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entities.py                     # –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game_socket_client.py           # –ö–ª–∏–µ–Ω—Ç + –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ models.py                   # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ database.py                 # DB connection
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ repositories.py             # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shop_parser.py                  # XML –ø–∞—Ä—Å–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ usecases/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parse_category.py               # –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_snapshot.py              # –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ calculate_diff.py               # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ interfaces/http/
‚îÇ       ‚îî‚îÄ‚îÄ routes.py                       # FastAPI —Ä–æ—É—Ç—ã
‚îú‚îÄ‚îÄ shop_workers/
‚îÇ   ‚îú‚îÄ‚îÄ worker_base.py                      # –ë–∞–∑–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ run_workers.py                      # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ moscow_worker.py                    # Moscow –≤–æ—Ä–∫–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ oasis_worker.py                     # Oasis –≤–æ—Ä–∫–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ neva_worker.py                      # Neva –≤–æ—Ä–∫–µ—Ä
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ conftest.py                         # Pytest —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_shop_parser.py                 # –¢–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ test_usecases.py                    # –¢–µ—Å—Ç—ã use cases
‚îî‚îÄ‚îÄ migrations/
    ‚îî‚îÄ‚îÄ V1__init_schema.sql                 # –°—Ö–µ–º–∞ –ë–î

HOST_API_SERVICE_SHOP_API.yml              # Docker Compose
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ–ª–µ–π

**damage** (—É—Ä–æ–Ω):
```
"S2-6" ‚Üí DamageComponent(type="S", min=2, max=6)
"E3-7,B4-8" ‚Üí [DamageComponent(type="E", min=3, max=7), ...]
```

**protect** (–∑–∞—â–∏—Ç–∞):
```
"S7-16,O1-5" ‚Üí [ProtectionComponent(type="S", min=7, max=16), ...]
```

**shot** (—Ä–µ–∂–∏–º—ã –∞—Ç–∞–∫–∏):
```
"2-3,3-5" ‚Üí [AttackMode(type=2, od=3), AttackMode(type=3, od=5)]
```

**min** (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è):
```
"level=6,str=14,man!1" ‚Üí Requirements(level=6, strength=14, gender="M")
```

**piercing** (–±—Ä–æ–Ω–µ–±–æ–π–Ω–æ—Å—Ç—å):
```
"500" ‚Üí 5.0%
```

**put_day** (–≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è):
```
"1749579438" ‚Üí datetime.utcfromtimestamp(1749579438)
```

### –¢–∏–ø—ã —É—Ä–æ–Ω–∞ –∏ –∑–∞—â–∏—Ç—ã

| –ö–æ–¥ | –¢–∏–ø |
|-----|-----|
| S | –£–¥–∞—Ä–Ω–æ–µ |
| E | –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–µ |
| B | –û–∂–æ–≥ |
| D | –û—Å–ª–µ–ø–ª–µ–Ω–∏–µ |
| P | –ü–∞—Ä–∞–ª–∏—á |
| N | –ü–∞–Ω–∏–∫–∞ |
| H | –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ |
| C | –ö–æ–Ω—Ç—É–∑–∏—è |
| Z | –ó–æ–º–±–∏—Ä–æ–≤–∞–Ω–∏–µ |
| V | –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ |
| O/A | –û—Ç—Ä–∞–≤–ª–µ–Ω–∏–µ |

---

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- [x] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–æ—Ç–æ–≤ (–∫–∞–∫ –≤ XML Workers)
- [x] –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö 27 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [x] –ü–∞–≥–∏–Ω–∞—Ü–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- [x] –†–∞—Å–∫—Ä—ã—Ç–∏–µ –≥—Ä—É–ø–ø —Ç–æ–≤–∞—Ä–æ–≤
- [x] –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
- [x] –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤
- [x] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤ (diff)
- [x] FastAPI —Å 10 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏
- [x] 3 –≤–æ—Ä–∫–µ—Ä–∞ (moscow/oasis/neva)
- [x] Keep-alive –ø–∏–Ω–≥–∏
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- [x] Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- [x] Traefik —Ä–æ—É—Ç–∏–Ω–≥
- [x] CLI –∫–æ–º–∞–Ω–¥—ã (ctl.sh)
- [x] Unit —Ç–µ—Å—Ç—ã (20+)
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

### ‚è≥ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

- [ ] Integration —Ç–µ—Å—Ç—ã
- [ ] SQL –≤–∏—Ç—Ä–∏–Ω—ã (marts/)
- [ ] –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- [ ] Prometheus –º–µ—Ç—Ä–∏–∫–∏
- [ ] Swagger OpenAPI spec

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç):
   ```bash
   export SOVA_MOSCOW_KEY=<–∏–∑ XML Workers>
   export SOVA_OASIS_KEY=<–∏–∑ XML Workers>
   export SOVA_NEVA_KEY=<–∏–∑ XML Workers>
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å API:**
   ```bash
   cd /Users/ii/Documents/code/WG_HUB/wg_client
   bash tools/ctl.sh api5-up-db
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä—ã:**
   ```bash
   cd api_5
   python shop_workers/run_workers.py
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:**
   ```bash
   curl http://localhost:8085/healthz
   curl http://localhost:8085/admin/bots/status
   ```

5. **–î–æ–∂–¥–∞—Ç—å—Å—è –ø–µ—Ä–≤–æ–≥–æ —Å–Ω–∏–º–∫–∞** (1 —á–∞—Å)

6. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã:**
   ```bash
   curl http://localhost:8085/items/list?shop_code=moscow
   ```

### –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é:

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω
- –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–∏—Ç—Ä–∏–Ω—ã
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º

### Traefik —Ä–æ—É—Ç–∏–Ω–≥

```yaml
# /api/shop/* ‚Üí api_5:8085
# /api/items/* ‚Üí api_5:8085
# /api/snapshots/* ‚Üí api_5:8085
```

### –û–±—â–∞—è —Å–µ—Ç—å

API 5 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `host-api-network` (–∫–∞–∫ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ API).

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –í–º–µ—Å—Ç–µ —Å–æ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–æ–º
bash tools/ctl.sh start-all

# –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
bash tools/ctl.sh api5-up-db
```

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å XML Workers

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | XML Workers | Shop Workers |
|----------------|-------------|--------------|
| **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** | `<LOGIN ... />` + GETME | ‚úÖ –¢–∞ –∂–µ! |
| **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** | `SOVA_*_KEY` | ‚úÖ –¢–µ –∂–µ! |
| **–°–µ—Ä–≤–µ—Ä** | `185.92.72.18:5190` | ‚úÖ –¢–æ—Ç –∂–µ! |
| **–ü—Ä–æ—Ç–æ–∫–æ–ª** | `//blook {id}` ‚Üí `<BLOOK>` | `<SH c="..." />` ‚Üí `<SH>` |
| **–í–æ—Ä–∫–µ—Ä—ã** | 6 (–ø–æ –±–∞—Ç—á–∞–º –±–æ—ë–≤) | 3 (–ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º) |
| **–ë–î** | –ù–µ—Ç (—Ñ–∞–π–ª—ã) | PostgreSQL `api5_shop` |
| **–°–Ω–∏–º–∫–∏** | –ù–µ—Ç | –ö–∞–∂–¥—ã–π —á–∞—Å |
| **Keep-alive** | `<N />` | ‚úÖ –¢–æ –∂–µ! |

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û—Ü–µ–Ω–∫–∏ –≤—Ä–µ–º–µ–Ω–∏

**–ü–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:**
- –•–æ–ª–æ–¥–Ω–æ–µ –æ—Ä—É–∂–∏–µ (k): ~2-5 —Å–µ–∫—É–Ω–¥
- –ü–∏—Å—Ç–æ–ª–µ—Ç—ã (p): ~5-10 —Å–µ–∫—É–Ω–¥
- –ë—Ä–æ–Ω—è (h, c, l, t, b): ~3-7 —Å–µ–∫—É–Ω–¥ –∫–∞–∂–¥–∞—è

**–ü–æ–ª–Ω—ã–π —Å–Ω–∏–º–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞:**
- –í—Å–µ 27 –∫–∞—Ç–µ–≥–æ—Ä–∏–π: **~5-10 –º–∏–Ω—É—Ç**
- –° —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ–º –≥—Ä—É–ø–ø: **~10-15 –º–∏–Ω—É—Ç**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–µ–ª–∞—Ç—å —Å–Ω–∏–º–∫–∏ —Ä–∞–∑ –≤ —á–∞—Å (–Ω–µ —á–∞—â–µ)
- –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏: 0.5-1 —Å–µ–∫—É–Ω–¥–∞
- Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö: 3 –ø–æ–ø—ã—Ç–∫–∏

### –†–∞–∑–º–µ—Ä –ë–î

**–û—Ü–µ–Ω–∫–∏:**
- 1 —Å–Ω–∏–º–æ–∫: ~50K —Ç–æ–≤–∞—Ä–æ–≤ √ó 3 –º–∞–≥–∞–∑–∏–Ω–∞ = 150K –∑–∞–ø–∏—Å–µ–π
- 24 —Å–Ω–∏–º–∫–∞/–¥–µ–Ω—å √ó 30 –¥–Ω–µ–π = 720 —Å–Ω–∏–º–∫–æ–≤
- **~108M –∑–∞–ø–∏—Å–µ–π/–º–µ—Å—è—Ü** –≤ `snapshot_items`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–Ω–∏–º–∫–∏ (> 30 –¥–Ω–µ–π).

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π

**–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å:**
```bash
# .gitignore
.env
.env.*
*.key
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
```bash
# –°–æ–∑–¥–∞—Ç—å .env.api5
SOVA_MOSCOW_KEY=...
SOVA_OASIS_KEY=...
SOVA_NEVA_KEY=...

# –ó–∞–≥—Ä—É–∑–∏—Ç—å
export $(cat .env.api5 | xargs)
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

- **api5_user** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è API 5
- **–û—Ç–¥–µ–ª—å–Ω–∞—è –ë–î** `api5_shop`
- **–ò–∑–æ–ª—è—Ü–∏—è** –æ—Ç –¥—Ä—É–≥–∏—Ö API

---

## Roadmap

### –í–µ—Ä—Å–∏—è 1.0 (—Ç–µ–∫—É—â–∞—è) ‚úÖ
- –ë–∞–∑–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥
- –°–Ω–∏–º–∫–∏ –∏ –¥–∏—Ñ—Ñ—ã
- API endpoints
- 3 –≤–æ—Ä–∫–µ—Ä–∞
- Unit —Ç–µ—Å—Ç—ã

### –í–µ—Ä—Å–∏—è 1.1 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- Integration —Ç–µ—Å—Ç—ã
- SQL –≤–∏—Ç—Ä–∏–Ω—ã (marts/)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ü–µ–Ω
- Prometheus –º–µ—Ç—Ä–∏–∫–∏

### –í–µ—Ä—Å–∏—è 2.0 (–±—É–¥—É—â–µ–µ)
- ML –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (–ø—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂)
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ–∫—É–ø–æ–∫
- –î–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π —Ü–µ–Ω
- –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

---

**–ì–æ—Ç–æ–≤–æ!** API 5 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–æ–µ–∫—Ç –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-10-11







