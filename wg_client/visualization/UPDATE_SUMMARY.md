# üéâ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–û—à–∏–±–∫–∞ "Failed to fetch"**
**–ü—Ä–æ–±–ª–µ–º–∞:** API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ baseURL

**–†–µ—à–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω—ë–Ω `baseURL` –≤ `api-client.js`:
  - **Localhost:** `http://localhost:8005`
  - **–ü—Ä–æ–¥–∞–∫—à–Ω:** `/api` (—á–µ—Ä–µ–∑ Nginx –ø—Ä–æ–∫—Å–∏)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```javascript
baseURL: window.location.hostname === 'localhost' 
  ? 'http://localhost:8005' 
  : '/api'
```

### 2. **–£–±—Ä–∞–Ω—ã —à–∞—Ö—Ç—ã –∏ —Ç–æ—á–∫–∏ —Ñ–∞—Ä–º–∞**
**–ë—ã–ª–æ:** 8 –ª–æ–∫–∞—Ü–∏–π (3 –∫—É–ø–æ–ª–∞ + 3 —à–∞—Ö—Ç—ã + 2 —Ñ–∞—Ä–º–∞)  
**–°—Ç–∞–ª–æ:** 3 –∫—É–ø–æ–ª–∞:
- ‚úÖ Old Moscow (6 —è—á–µ–µ–∫)
- ‚úÖ Neva City (6 —è—á–µ–µ–∫)
- ‚úÖ Oasis (6 —è—á–µ–µ–∫)

### 3. **–£–º–µ–Ω—å—à–µ–Ω—ã –∫—Ä—É–≥–∏ –ª–æ–∫–∞—Ü–∏–π**
**–ë—ã–ª–æ:** —Ä–∞–¥–∏—É—Å 12/10/14 ‚Üí —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ –∫—Ä—É–≥–∏  
**–°—Ç–∞–ª–æ:** —Ä–∞–¥–∏—É—Å 3 + –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç `* 0.5` ‚Üí –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

---

## üÜï –ù–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã

### 1. üî• **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã**
**URL:** http://localhost:14488/analytics-heatmap.html

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö:**
- üìä **Analytics Heatmap** ‚Äî `/analytics/map/heatmap`
- üè∞ **PvE Top Locations** ‚Äî `/analytics/pve/top-locations`
- ‚öîÔ∏è **PvP Hotspots** ‚Äî `/analytics/map/pvp-hotspots`

**–§–∏–ª—å—Ç—Ä—ã:**
- –î–∞—Ç–∞ –æ—Ç/–¥–æ
- –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –†–∞–¥–∏—É—Å –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ç–æ—á–µ–∫

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ (-180..180)
- –ó—É–º, –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- Tooltip —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

---

### 2. ‚öîÔ∏è **PvP ELO –∏ –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏**
**URL:** http://localhost:14488/analytics-pvp-elo.html

**–î–≤–µ –≤–∫–ª–∞–¥–∫–∏:**

#### –í–∫–ª–∞–¥–∫–∞ "ELO –†–µ–π—Ç–∏–Ω–≥"
- **Endpoint:** `/analytics/pvp/elo`
- **–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤** —Å —Ä–∞–Ω–≥–∞–º–∏ (ü•áü•àü•â)
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** —Ç–æ–ø ELO, —Å—Ä–µ–¥–Ω–∏–π ELO, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
- **–§–∏–ª—å—Ç—Ä—ã:** –¥–∞—Ç–∞ –æ—Ç/–¥–æ, –ª–∏–º–∏—Ç

#### –í–∫–ª–∞–¥–∫–∞ "–ü–æ –ü—Ä–æ—Ñ–µ—Å—Å–∏—è–º"
- **Endpoint:** `/players/by-profession`
- **–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏:**
  - üõ°Ô∏è –¢–∞–Ω–∫ (–∫—Ä–∞—Å–Ω—ã–π)
  - ‚öîÔ∏è –î–∞–º–∞–≥–µ—Ä (–∂—ë–ª—Ç—ã–π)
  - üíö –•–∏–ª–µ—Ä (–∑–µ–ª—ë–Ω—ã–π)
  - üîß –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (—Å–∏–Ω–∏–π)
- **–ì—Ä–∞—Ñ–∏–∫:** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º (donut chart)
- **–§–∏–ª—å—Ç—Ä—ã:** –¥–∞—Ç–∞ –æ—Ç/–¥–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏—è

---

### 3. ‚è∞ **–ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)**
**URL:** http://localhost:14488/analytics-peak-hours.html

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- üî• **Activity Heatmap** ‚Äî `/analytics/time/activity-heatmap`
  - –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –ø–æ –¥–Ω—è–º –∏ —á–∞—Å–∞–º
  - –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 30 –¥–Ω–µ–π √ó 24 —á–∞—Å–∞
  - –§–æ—Ä–º–∞—Ç –¥–∞—Ç –≤ —è—á–µ–π–∫–∞—Ö (–¥–¥.–º–º)

---

## üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–∞—à–±–æ—Ä–¥–æ–≤ (10 —à—Ç—É–∫)

| # | –î–∞—à–±–æ—Ä–¥ | URL | –°—Ç–∞—Ç—É—Å |
|---|---------|-----|--------|
| 1 | –ì–ª–∞–≤–Ω–∞—è | http://localhost:14488 | ‚úÖ |
| 2 | Heatmap (—Ä–µ–¥–∞–∫—Ç–æ—Ä) | /heatmap.html | ‚úÖ |
| 3 | Players | /players.html | ‚úÖ |
| 4 | Antibot | /antibot.html | ‚úÖ |
| 5 | ML Clusters | /ml-clusters.html | ‚úÖ |
| 6 | üÜï Analytics Heatmap | /analytics-heatmap.html | ‚úÖ |
| 7 | üÜï Clan Control | /analytics-clan-control.html | ‚úÖ |
| 8 | üÜï Peak Hours | /analytics-peak-hours.html | ‚úÖ |
| 9 | üÜï PvP ELO | /analytics-pvp-elo.html | ‚úÖ |
| 10 | üÜï Churn Prediction | /analytics-churn.html | ‚úÖ |

---

## üîå –ù–æ–≤—ã–µ API Endpoints

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤ `api-client.js`:

```javascript
// –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã
api.getAnalyticsHeatmap({ date_from, date_to })
api.getPveTopLocations({ date_from, date_to, limit })
api.getPvpHotspots({ date_from, date_to })

// –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–ª–∞–Ω–æ–≤
api.getMapClanControl(days)

// –ü–∏–∫–æ–≤—ã–µ —á–∞—Å—ã
api.getPeakHours({ date_from, date_to, timezone })
api.getActivityHeatmap({ date_from, date_to })

// PvP ELO
api.getPvpElo({ date_from, date_to, limit })

// –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏
api.getPlayersByProfession({ date_from, date_to, profession })

// –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –æ—Ç—Ç–æ–∫–∞
api.getChurnPrediction({ date_from, date_to, risk_threshold, limit })
api.getPlayerChurnDetails(accountId)
```

---

## üé® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ UI

### –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º
–í—Å–µ –Ω–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç:
- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ (–¥–∞—Ç–∞ –æ—Ç/–¥–æ)
- –ê–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7/30 –¥–Ω–µ–π)
- –£–¥–æ–±–Ω—ã–µ date picker

### –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
–ö–∞–∂–¥—ã–π –¥–∞—à–±–æ—Ä–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ API
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π UI

### –≠–∫—Å–ø–æ—Ä—Ç
- CSV —ç–∫—Å–ø–æ—Ä—Ç –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–ª–∞–Ω–æ–≤ –∏ –æ—Ç—Ç–æ–∫–∞
- –§–æ—Ä–º–∞—Ç: UTF-8, –∑–∞–ø—è—Ç–∞—è

### –ì—Ä–∞—Ñ–∏–∫–∏
- Chart.js 4.4.0 –¥–ª—è 2D –≥—Ä–∞—Ñ–∏–∫–æ–≤
- –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –≤–æ –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–∞—Ö
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ tooltips

---

## üåê –î–æ—Å—Ç—É–ø

**–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:** http://localhost:14488

–í—Å–µ 10 –¥–∞—à–±–æ—Ä–¥–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏—é –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.

---

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API5

### –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –Ω—É–∂–Ω—ã endpoints:

```python
# –í API5 –¥–æ–±–∞–≤–∏—Ç—å:

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–∞—Ä—Ç
GET /analytics/map/heatmap?date_from=...&date_to=...
GET /analytics/pve/top-locations?date_from=...&date_to=...&limit=100
GET /analytics/map/pvp-hotspots?date_from=...&date_to=...

# –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–ª–∞–Ω–æ–≤
GET /analytics/map/clan-control?days=30

# –í—Ä–µ–º—è
GET /analytics/time/peak-hours?date_from=...&date_to=...&timezone=...
GET /analytics/time/activity-heatmap?date_from=...&date_to=...

# PvP
GET /analytics/pvp/elo?date_from=...&date_to=...&limit=50

# –ü—Ä–æ—Ñ–µ—Å—Å–∏–∏
GET /players/by-profession?date_from=...&date_to=...&profession=...

# –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
GET /analytics/predictions/churn?date_from=...&date_to=...&risk_threshold=70&limit=50
GET /analytics/predictions/churn/{account_id}
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:14488
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ –¥–∞—à–±–æ—Ä–¥—ã (—Ä–∞–±–æ—Ç–∞—é—Ç —Å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏)
3. ‚öôÔ∏è –†–µ–∞–ª–∏–∑—É–π—Ç–µ API endpoints –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
4. üîÑ –û–±–Ω–æ–≤–∏—Ç–µ `baseURL` –µ—Å–ª–∏ API –∑–∞–ø—É—â–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É
5. üìä –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π!

---

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ API

–ï—Å–ª–∏ API –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8005:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:8005/health

# –¢–µ—Å—Ç endpoint (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
curl http://localhost:8005/analytics/map/heatmap?date_from=2025-10-01&date_to=2025-10-11
```

---

## üìù Changelog

### 2025-10-11 ‚Äî Update 2

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- analytics-heatmap.html (3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
- analytics-pvp-elo.html (ELO + –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏)
- Activity heatmap –≤ analytics-peak-hours.html
- 6 –Ω–æ–≤—ã—Ö API endpoints –≤ api-client.js

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- API baseURL (localhost:8005 –≤–º–µ—Å—Ç–æ api_5:8005)
- –†–∞–¥–∏—É—Å—ã –ª–æ–∫–∞—Ü–∏–π (3 –≤–º–µ—Å—Ç–æ 12)
- –£–¥–∞–ª–µ–Ω—ã —à–∞—Ö—Ç—ã –∏ —Ç–æ—á–∫–∏ —Ñ–∞—Ä–º–∞ –∏–∑ locations.json

**–£–ª—É—á—à–µ–Ω–æ:**
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–¥–æ–±–∞–≤–ª–µ–Ω—ã 2 –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–∫–∏)
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–∞–º –≤–æ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞—à–±–æ—Ä–¥–∞—Ö
- –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –°–∏—Å—Ç–µ–º–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.









