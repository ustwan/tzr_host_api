# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Äî –ì–æ—Ç–æ–≤–æ!

## üîß –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **API baseURL** ‚Üí –ß–µ—Ä–µ–∑ Nginx –ø—Ä–æ–∫—Å–∏
**–ë—ã–ª–æ:** `http://localhost:8005` (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞)  
**–°—Ç–∞–ª–æ:** `/api` (—á–µ—Ä–µ–∑ Nginx –ø—Ä–æ–∫—Å–∏)

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ `host.docker.internal:8005`
- Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ `/api/*` ‚Üí `http://host.docker.internal:8005/`

### 2. **Nginx –ø—Ä–æ–∫—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `nginx.conf`:

```nginx
location /api/ {
    proxy_pass http://host.docker.internal:8005/;
    proxy_set_header Host $host;
    proxy_connect_timeout 30s;
    proxy_read_timeout 30s;
    
    # CORS headers
    add_header Access-Control-Allow-Origin * always;
    
    # SSE support
    proxy_buffering off;
    proxy_cache off;
}
```

### 3. **–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ**
–£–±—Ä–∞–Ω—ã –∏–∑ –≤—Å–µ—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤:
- ‚úÖ heatmap.html
- ‚úÖ players.html  
- ‚úÖ analytics-heatmap.html
- ‚úÖ analytics-clan-control.html
- ‚úÖ analytics-peak-hours.html
- ‚úÖ analytics-pvp-elo.html
- ‚úÖ analytics-churn.html

---

## üöÄ –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ö–µ–º–∞ –∑–∞–ø—Ä–æ—Å–æ–≤:

```
–ë—Ä–∞—É–∑–µ—Ä ‚Üí http://localhost:14488/api/...
          ‚Üì
    Nginx (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
          ‚Üì
    host.docker.internal:8005
          ‚Üì
    API5 (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)
```

---

## ‚ö° –ó–∞–ø—É—Å–∫ API5 (–Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã)

### –í–∞—Ä–∏–∞–Ω—Ç 1: API5 —É–∂–µ –∑–∞–ø—É—â–µ–Ω

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
curl http://localhost:8005/health

# –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç OK ‚Äî –≤—Å—ë –≥–æ—Ç–æ–≤–æ!
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å API5

```bash
# –ï—Å–ª–∏ API5 –≤ Docker
docker-compose -f docker-compose.api5.yml up -d

# –ï—Å–ª–∏ API5 –ª–æ–∫–∞–ª—å–Ω–æ
cd wg_client/api_5
uvicorn app.main:app --host 0.0.0.0 --port 8005
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏:

```bash
# Health check —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
curl http://localhost:14488/api/health
# –û–∂–∏–¥–∞–µ—Ç—Å—è: {"status": "ok"} –∏–ª–∏ –ø–æ—Ö–æ–∂–µ–µ

# –ï—Å–ª–∏ 502 Bad Gateway ‚Äî API5 –Ω–µ –∑–∞–ø—É—â–µ–Ω
# –ï—Å–ª–∏ 404 ‚Äî endpoint –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
# –ï—Å–ª–∏ 200 ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

---

## üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:14488

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –¥–∞—à–±–æ—Ä–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Analytics Heatmap)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞—Ç—ã
3. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å"
4. –ï—Å–ª–∏ API –∑–∞–ø—É—â–µ–Ω ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è
5. –ï—Å–ª–∏ API –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Äî –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞ (–¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –±–æ–ª—å—à–µ –ù–ï –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è)

---

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

```
‚úÖ Nginx –ø—Ä–æ–∫—Å–∏: –Ω–∞—Å—Ç—Ä–æ–µ–Ω
‚úÖ API baseURL: /api
‚úÖ –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ: —É–¥–∞–ª–µ–Ω—ã
‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä: –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω –∏ –∑–∞–ø—É—â–µ–Ω
‚úÖ –ü–æ—Ä—Ç: 14488
‚ö†Ô∏è API5: –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ø–æ—Ä—Ç—É 8005
```

---

## üîå API Endpoints (–Ω—É–∂–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã)

–î–∞—à–±–æ—Ä–¥—ã –±—É–¥—É—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å:

```
GET /api/battles/heatmap
GET /api/analytics/map/heatmap
GET /api/analytics/pve/top-locations
GET /api/analytics/map/pvp-hotspots
GET /api/analytics/map/clan-control
GET /api/analytics/time/peak-hours
GET /api/analytics/time/activity-heatmap
GET /api/analytics/pvp/elo
GET /api/players/by-profession
GET /api/analytics/predictions/churn
```

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ Nginx –ø—Ä–æ–∫—Å–∏ ‚Üí `http://host.docker.internal:8005/`

---

## üêõ –ï—Å–ª–∏ API –Ω–∞ –¥—Ä—É–≥–æ–º –ø–æ—Ä—Ç—É

### –ò–∑–º–µ–Ω–∏—Ç—å –≤ `nginx.conf`:

```nginx
location /api/ {
    proxy_pass http://host.docker.internal:–î–†–£–ì–û–ô_–ü–û–†–¢/;
    ...
}
```

### –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å:

```bash
docker-compose -f docker-compose.viz.yml up -d --build
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx.conf –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker exec wg_visualization cat /etc/nginx/conf.d/default.conf | grep proxy_pass

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# proxy_pass http://host.docker.internal:8005/;

# –ü—Ä–æ–≤–µ—Ä–∫–∞ api-client.js
curl -s http://localhost:14488/assets/js/api-client.js | grep baseURL

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# baseURL: '/api',
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å API5 –Ω–∞ –ø–æ—Ä—Ç—É 8005**
   ```bash
   # –ù–∞–ø—Ä–∏–º–µ—Ä
   cd wg_client/api_5
   uvicorn app.main:app --host 0.0.0.0 --port 8005
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check**
   ```bash
   curl http://localhost:8005/health
   curl http://localhost:14488/api/health
   ```

3. **–û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥—ã**
   ```
   http://localhost:14488
   ```

4. **–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ**
   - –í—ã–±—Ä–∞—Ç—å –¥–∞—à–±–æ—Ä–¥
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
   - –ù–∞–∂–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å"
   - –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–¥—É—Ç –∏–∑ API!

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

- ‚úÖ **–ù–µ—Ç CORS –ø—Ä–æ–±–ª–µ–º** ‚Äî –≤—Å—ë —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
- ‚úÖ **–ï–¥–∏–Ω—ã–π –¥–æ–º–µ–Ω** ‚Äî `localhost:14488` –¥–ª—è UI –∏ API
- ‚úÖ **SSE support** ‚Äî –¥–ª—è real-time –≤ antibot
- ‚úÖ **–ù–µ—Ç –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö** ‚Äî —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
- ‚úÖ **Timeout 30s** ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

**–ì–æ—Ç–æ–≤–æ!** üéâ 

API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å API5 –Ω–∞ –ø–æ—Ä—Ç—É 8005.









