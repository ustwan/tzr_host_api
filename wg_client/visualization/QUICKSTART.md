# ๐ WG_HUB Visualization โ ะัััััะน ััะฐัั

## ะงัะพ ัะพะทะดะฐะฝะพ?

ะะพะปะฝะพัะตะฝะฝัะน ะบะพะฝัะตะนะฝะตั ะฒะธะทัะฐะปะธะทะฐัะธะธ ั 4 ะธะฝัะตัะฐะบัะธะฒะฝัะผะธ ะดะฐัะฑะพัะดะฐะผะธ:

1. **๐บ๏ธ Heatmap** โ ะธะฝัะตัะฐะบัะธะฒะฝะฐั ะบะฐััะฐ ะผะธัะฐ ั ัะตะฟะปะพะฒะพะน ะบะฐััะพะน ะฑะพัะฒ
2. **๐ค Players** โ ะฟะพะธัะบ ะธะณัะพะบะพะฒ, ะดะตัะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ, ะณัะฐัะธะบะธ
3. **๐ค Antibot** โ real-time ะผะพะฝะธัะพัะธะฝะณ ะฟัะพะฒะตัะพะบ ะฝะฐ ะฑะพัะพะฒ (SSE)
4. **๐ฏ ML Clusters** โ 3D ะฒะธะทัะฐะปะธะทะฐัะธั K-Means ะบะปะฐััะตัะพะฒ ััะธะปะตะน ะธะณัั

---

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
wg_client/visualization/
โโโ Dockerfile                 # Nginx Alpine
โโโ docker-compose.viz.yml     # Docker Compose ะบะพะฝัะธะณััะฐัะธั
โโโ nginx.conf                 # Nginx ะบะพะฝัะธะณััะฐัะธั
โโโ README.md                  # ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
โโโ QUICKSTART.md             # ะญัะพั ัะฐะนะป
โโโ public/                    # ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั
    โโโ index.html             # ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ (ะฝะฐะฒะธะณะฐัะธั)
    โโโ heatmap.html           # ะขะตะฟะปะพะฒะฐั ะบะฐััะฐ
    โโโ players.html           # ะะพะธัะบ ะธะณัะพะบะพะฒ
    โโโ antibot.html           # ะะฝัะธะฑะพั ะผะพะฝะธัะพัะธะฝะณ
    โโโ ml-clusters.html       # ML ะบะปะฐััะตัั
    โโโ assets/
        โโโ js/
        โ   โโโ api-client.js  # ะะฑัะธะน API ะบะปะธะตะฝั
        โโโ css/
            โโโ common.css     # ะะฑัะธะต ััะธะปะธ
```

---

## ะะฐะฟััะบ ะทะฐ 3 ัะฐะณะฐ

### ะจะฐะณ 1: ะะฐัััะพะนะบะฐ DNS

ะะพะฑะฐะฒััะต ะฒ `/etc/hosts`:

```bash
sudo nano /etc/hosts
```

ะะพะฑะฐะฒะธัั ัััะพะบั:

```
127.0.0.1 viz.wg.local
```

ะกะพััะฐะฝะธัั: `Ctrl+O`, `Enter`, ะฒัะนัะธ: `Ctrl+X`

---

### ะจะฐะณ 2: ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ

```bash
cd /Users/ii/Documents/code/WG_HUB/wg_client/visualization
docker-compose -f docker-compose.viz.yml up -d --build
```

**ะะถะธะดะฐะตะผัะน ะฒัะฒะพะด:**

```
[+] Building 12.3s (8/8) FINISHED
[+] Running 1/1
 โ Container wg_visualization  Started
```

---

### ะจะฐะณ 3: ะัะพะฒะตัะบะฐ

```bash
# ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะฐ
docker ps | grep wg_visualization

# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
docker logs wg_visualization

# Health check
curl http://localhost/health
# ะัะฒะตั: OK
```

---

## ะะพัััะฟ ะบ ะดะฐัะฑะพัะดะฐะผ

ะะพัะปะต ะทะฐะฟััะบะฐ ะพัะบัััั ะฒ ะฑัะฐัะทะตัะต:

- **ะะปะฐะฒะฝะฐั:** https://viz.wg.local
- **Heatmap:** https://viz.wg.local/heatmap.html
- **Players:** https://viz.wg.local/players.html
- **Antibot:** https://viz.wg.local/antibot.html
- **ML Clusters:** https://viz.wg.local/ml-clusters.html

> โ๏ธ **ะะฐะถะฝะพ:** ะฃะฑะตะดะธัะตัั, ััะพ Traefik ะทะฐะฟััะตะฝ ะธ ะฝะฐัััะพะตะฝ ะดะปั `wg_internal` ัะตัะธ.

---

## API Endpoints (ะธัะฟะพะปัะทัะตะผัะต ะดะฐัะฑะพัะดะฐะผะธ)

ะะธะทัะฐะปะธะทะฐัะธั ะธะฝัะตะณัะธััะตััั ั API5:

| Endpoint | ะะฐัะฑะพัะด | ะะฟะธัะฐะฝะธะต |
|----------|---------|----------|
| `GET /battles/heatmap` | Heatmap | ะะฐะฝะฝัะต ะดะปั ัะตะฟะปะพะฒะพะน ะบะฐััั |
| `GET /player/search?nickname={name}` | Players | ะะพะธัะบ ะธะณัะพะบะฐ |
| `GET /player/{id}/stats` | Players | ะกัะฐัะธััะธะบะฐ ะธะณัะพะบะฐ |
| `GET /antibot/check?account_id={id}` | Players, Antibot | ะัะพะฒะตัะบะฐ ะฝะฐ ะฑะพัะฐ |
| `GET /antibot/recent?limit=100` | Antibot | ะะพัะปะตะดะฝะธะต ะฟัะพะฒะตัะบะธ |
| `GET /antibot/stream` (SSE) | Antibot | Real-time ะฟะพัะพะบ |
| `GET /ml/clusters/stats` | ML Clusters | ะกัะฐัะธััะธะบะฐ ะบะปะฐััะตัะพะฒ |
| `GET /ml/cluster/{id}/players` | ML Clusters | ะะณัะพะบะธ ะบะปะฐััะตัะฐ |

---

## ะัััััะต ะบะพะผะฐะฝะดั

```bash
# ะะตัะตัะฑะพัะบะฐ ะธ ะฟะตัะตะทะฐะฟััะบ
docker-compose -f docker-compose.viz.yml up -d --build --force-recreate

# ะััะฐะฝะพะฒะบะฐ
docker-compose -f docker-compose.viz.yml down

# ะะพะณะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
docker logs -f wg_visualization

# ะะตัะตะทะฐะฟััะบ ะฑะตะท ะฟะตัะตัะฑะพัะบะธ
docker restart wg_visualization

# ะะฑะฝะพะฒะธัั ัะพะปัะบะพ HTML/CSS/JS (ะฑะตะท ะฟะตัะตัะฑะพัะบะธ)
docker cp public/heatmap.html wg_visualization:/usr/share/nginx/html/
docker exec wg_visualization nginx -s reload
```

---

## ะะฐะทัะฐะฑะพัะบะฐ ะฑะตะท Docker

ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ:

```bash
cd public
python3 -m http.server 8080
```

ะัะบัััั: http://localhost:8080

> **ะัะธะผะตัะฐะฝะธะต:** API ะทะฐะฟัะพัั ะฑัะดัั ะฝะตะดะพัััะฟะฝั ะฑะตะท ะฟัะพะบัะธ ะธะปะธ ะฝะฐัััะพะนะบะธ CORS.

---

## ะะฐัััะพะนะบะฐ API URL

ะะพ ัะผะพะปัะฐะฝะธั ะดะฐัะฑะพัะดั ะฟะพะดะบะปััะฐัััั ะบ API ัะตัะตะท ะฒะฝัััะตะฝะฝัั Docker ัะตัั:

```javascript
// ะ ัะฐะนะปะต: public/assets/js/api-client.js
const API_CONFIG = {
  baseURL: 'http://api_5:8005',  // โ ะะพ ัะผะพะปัะฐะฝะธั
};
```

**ะัะปะธ ะฝัะถะตะฝ ะฟัะพะบัะธ ัะตัะตะท Nginx** (ะดะปั CORS):

1. ะะฐัะบะพะผะผะตะฝัะธัะพะฒะฐัั ะฟัะพะบัะธ ะฒ `nginx.conf`:

```nginx
location /api/ {
    proxy_pass http://api_5:8005/;
    proxy_set_header Host $host;
}
```

2. ะะทะผะตะฝะธัั URL ะฒ `api-client.js`:

```javascript
baseURL: '/api/v5',  // โ ะัะฝะพัะธัะตะปัะฝัะน ะฟััั
```

3. ะะตัะตัะพะฑัะฐัั:

```bash
docker-compose -f docker-compose.viz.yml up -d --build
```

---

## Troubleshooting

### ะัะพะฑะปะตะผะฐ: "viz.wg.local ะฝะต ะพัะบััะฒะฐะตััั"

**ะะตัะตะฝะธะต:**

1. ะัะพะฒะตัััะต DNS:
   ```bash
   ping viz.wg.local
   ```

2. ะัะพะฒะตัััะต Traefik:
   ```bash
   docker logs traefik | grep viz
   ```

3. ะัะพะฒะตัััะต ัะตัั:
   ```bash
   docker network inspect wg_internal
   ```

---

### ะัะพะฑะปะตะผะฐ: "API ะฝะตะดะพัััะฟะตะฝ"

**ะะตัะตะฝะธะต:**

1. ะัะพะฒะตัััะต API5:
   ```bash
   docker ps | grep api_5
   curl http://api_5:8005/health
   ```

2. ะัะพะฒะตัััะต ัะตัั:
   ```bash
   docker network connect wg_internal wg_visualization
   ```

---

### ะัะพะฑะปะตะผะฐ: "Real-time ะฟะพัะพะบ ะฝะต ัะฐะฑะพัะฐะตั"

**ะะตัะตะฝะธะต:**

SSE ััะตะฑัะตั ะฟัะฐะฒะธะปัะฝะพะน ะฝะฐัััะพะนะบะธ Nginx ะดะปั ะดะปะธะฝะฝัั ัะพะตะดะธะฝะตะฝะธะน:

```nginx
location /api/antibot/stream {
    proxy_pass http://api_5:8005/antibot/stream;
    proxy_buffering off;
    proxy_cache off;
    proxy_read_timeout 3600s;
}
```

---

## ะกะปะตะดัััะธะต ัะฐะณะธ

1. โ ะะฐะฟัััะธัะต ะบะพะฝัะตะนะฝะตั
2. โ ะัะบัะพะนัะต https://viz.wg.local
3. โ ะัะพัะตััะธััะนัะต ะฒัะต 4 ะดะฐัะฑะพัะดะฐ
4. โ๏ธ ะะฐัััะพะนัะต ะธะฝัะตะณัะฐัะธั ั ัะตะฐะปัะฝัะผ API5
5. ๐จ ะะฐััะพะผะธะทะธััะนัะต ะดะธะทะฐะนะฝ ะฟะพะด ัะฒะพะธ ะฝัะถะดั
6. ๐ ะะพะฑะฐะฒััะต ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ะดะฐัะฑะพัะดั

---

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ
โ   Browser   โโโโโโโถโ   Traefik   โโโโโโโถโ Nginx (viz) โ
โ viz.wg.localโ      โ   (443)     โ      โ   (port 80) โ
โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ
                            โ                     โ
                            โ                     โ
                            โผ                     โผ
                     โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ
                     โ   API 5     โโโโโโโโ api-client.jsโ
                     โ  (port 8005)โ      โ  (fetch)    โ
                     โโโโโโโโโโโโโโโ      โโโโโโโโโโโโโโโ
```

---

## ะขะตัะฝะพะปะพะณะธะธ

- **Frontend:** Vanilla JS + HTML5 Canvas
- **ะัะฐัะธะบะธ:** Chart.js 4.4.0 (2D), Plotly.js 2.27.0 (3D)
- **Real-time:** Server-Sent Events (SSE)
- **HTTP Client:** Fetch API ั retry
- **ะกะตัะฒะตั:** Nginx 1.25 Alpine
- **UI:** Custom CSS (ััะผะฝะฐั ัะตะผะฐ)

---

## ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- Gzip ัะถะฐัะธะต ะดะปั ะฒัะตั ัะตะบััะพะฒัั ัะตััััะพะฒ
- ะััะธัะพะฒะฐะฝะธะต ััะฐัะธะบะธ (7 ะดะฝะตะน)
- Lazy loading ะดะปั ะณัะฐัะธะบะพะฒ
- Debounce ะดะปั ะฟะพะธัะบะฐ
- Responsive design

---

## ะะตะทะพะฟะฐัะฝะพััั

ะะปั ะดะพะฑะฐะฒะปะตะฝะธั ะฑะฐะทะพะฒะพะน ะฐะฒัะพัะธะทะฐัะธะธ:

```bash
# ะะตะฝะตัะฐัะธั ะฟะฐัะพะปั
htpasswd -nb admin mypassword
# ะะตะทัะปััะฐั: admin:$apr1$...

# ะะพะฑะฐะฒะธัั ะฒ docker-compose.viz.yml (ัะฐัะบะพะผะผะตะฝัะธัะพะฒะฐัั middleware)
```

---

## ะะพะดะดะตัะถะบะฐ

- **ะะพะบัะผะตะฝัะฐัะธั:** `README.md`
- **ะะพะณะธ:** `docker logs wg_visualization`
- **Health:** `curl http://localhost/health`

---

**ะะพัะพะฒะพ! ๐ ะะพะฝัะตะนะฝะตั ะฒะธะทัะฐะปะธะทะฐัะธะธ ะฟะพะปะฝะพัััั ะฝะฐัััะพะตะฝ ะธ ะณะพัะพะฒ ะบ ัะฐะฑะพัะต.**









