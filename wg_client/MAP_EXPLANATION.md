# üó∫Ô∏è –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç—É –±–æ—è

## ‚ùó –í–ê–ñ–ù–û–ï –û–¢–ö–†–´–¢–ò–ï

### –§–∞–π–ª—ã –≤ `/srv/btl/raw` –ù–ï —Å–æ–¥–µ—Ä–∂–∞—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É!

–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤:
```xml
<BLOOK><BATTLE t="40" t2="1759857690" new_battle="1" turn="11" ...>
  <USER battleid="3769990" login="–ó–º–µ–π" ...>
    <!-- –î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
  </USER>
</BATTLE></BLOOK>
```

**–í —ç—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –Ω–µ—Ç —Ç–µ–≥–∞ `<map>`!** –¢–æ–ª—å–∫–æ `map_patch`:

```json
{
  "i": "m_2D425852A5A36CC3",        // ID —à–∞–±–ª–æ–Ω–∞ –∫–∞—Ä—Ç—ã
  "cs": "blake2s8:2D425852A5A36CC3"  // –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞
}
```

---

## ‚úÖ –ì–¥–µ –†–ï–ê–õ–¨–ù–û —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞—Ä—Ç–∞?

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ (—É —Å–µ—Ä–≤–µ—Ä–∞)

–ò–≥—Ä–æ–≤–æ–π —Å–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É –±–∞–∑–æ–≤—ã—Ö –∫–∞—Ä—Ç (~100-500 —à–∞–±–ª–æ–Ω–æ–≤).

**–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç—É –Ω—É–∂–Ω–æ:**
1. –ò–º–µ—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —à–∞–±–ª–æ–Ω–æ–≤
2. –ò–∑–≤–ª–µ—á—å `map_template_id` –∏–∑ `map_patch.i`
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω –ø–æ ID

**–ü—Ä–∏–º–µ—Ä:**
```python
map_templates = load_templates()  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤
template_id = "m_2D425852A5A36CC3"
full_map = map_templates[template_id]
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—Ä–æ—Å –∫ –∏–≥—Ä–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ä—Ç—ã:

```bash
# –ü—Å–µ–≤–¥–æ–∫–æ–¥
GET /game/map/{template_id}
# –í–µ—Ä–Ω—ë—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –î–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏–≥—Ä–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–ª–∏–µ–Ω—Ç—É –∏–≥—Ä—ã:
1. –ù–∞–π—Ç–∏ —Ñ–∞–π–ª—ã –∫–∞—Ä—Ç (–æ–±—ã—á–Ω–æ –≤ `maps/` –∏–ª–∏ `data/maps/`)
2. –ò–∑–≤–ª–µ—á—å —à–∞–±–ª–æ–Ω—ã
3. –°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É

---

## üìã –ß—Ç–æ –ú–û–ñ–ù–û –∏–∑–≤–ª–µ—á—å –∏–∑ –±–æ—è?

### ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ:
- `map_patch.i` - ID —à–∞–±–ª–æ–Ω–∞ –∫–∞—Ä—Ç—ã
- `map_patch.cs` - –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞
- –£—á–∞—Å—Ç–Ω–∏–∫–∏, –º–æ–Ω—Å—Ç—Ä—ã, –ª—É—Ç
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–æ—è (loc_x, loc_y)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### ‚ùå –ù–ï –¥–æ—Å—Ç—É–ø–Ω–æ:
- –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ (—Ç–æ–ª—å–∫–æ ID —à–∞–±–ª–æ–Ω–∞)
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ
- –ü–æ–ª–æ–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤/–º–æ–Ω—Å—Ç—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ

---

## üîß –°–∫—Ä–∏–ø—Ç `get_battle_map.py`

**–†–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏:**
- –§–∞–π–ª –±–æ—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–≥ `<map>` (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç XML)
- –ö–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î –≤ –ø–æ–ª–µ `data.battle.map`

**–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ–∞–π–ª–∞–º–∏ –∏–∑ `/srv/btl/raw`:**
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `map_patch`
- –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –ª–æ–≥–µ –±–æ—è

---

## üí° –†–µ—à–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ —Å–ª—É—á–∞—è

### –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Ç–æ–∫–µ–Ω—ã –∫–∞—Ä—Ç—ã (—Å–∏–º–≤–æ–ª—ã):

**–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ —Ñ–∞–π–ª–æ–≤ –±–æ—è.** –ù—É–∂–Ω–æ –ª–∏–±–æ:

1. **–ü–æ–ª—É—á–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —à–∞–±–ª–æ–Ω–æ–≤** —Å —Å–µ—Ä–≤–µ—Ä–∞
2. **–†–µ–≤–µ—Ä—Å-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥** –∏–≥—Ä–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
3. **–ó–∞–ø—Ä–æ—Å–∏—Ç—å —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** –∏–≥—Ä—ã

### –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

```bash
# –ü–æ–ª—É—á–∏—Ç—å map_patch
curl -s 'http://localhost:8084/battle/3769990' | jq '.map_patch | fromjson'

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#   "i": "m_2D425852A5A36CC3",
#   "cs": "blake2s8:2D425852A5A36CC3"
# }
```

---

## üéØ –ò–¢–û–ì–û

| –î–∞–Ω–Ω—ã–µ | –î–æ—Å—Ç—É–ø–Ω—ã –≤ –±–æ—é | –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å |
|--------|---------------|--------------|
| ID —à–∞–±–ª–æ–Ω–∞ –∫–∞—Ä—Ç—ã | ‚úÖ –î–∞ | `.map_patch.i` |
| –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ | ‚úÖ –î–∞ | `.map_patch.cs` |
| **–ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞** | ‚ùå –ù–µ—Ç | **–ù—É–∂–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤** |
| –¢–æ–∫–µ–Ω—ã –∫–∞—Ä—Ç—ã | ‚ùå –ù–µ—Ç | **–ù—É–∂–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤** |
| –£—á–∞—Å—Ç–Ω–∏–∫–∏ | ‚úÖ –î–∞ | API `/battle/{id}` |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | ‚úÖ –î–∞ | API `/battle/{id}` |

---

## üìù –°–ö–†–ò–ü–¢ (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

–°–∫—Ä–∏–ø—Ç `get_battle_map.py` —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ:
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç** —Å –±–æ—è–º–∏ –≤ —Å—Ç–∞—Ä–æ–º —Ñ–æ—Ä–º–∞—Ç–µ XML (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚ùå **–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –±–æ—è–º–∏ –∏–∑ `/srv/btl/raw`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python3 get_battle_map.py 3769990          # –í–∏–∑—É–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
python3 get_battle_map.py 3769990 --json   # JSON —Ñ–æ—Ä–º–∞—Ç
python3 get_battle_map.py 3769990 --tokens # –¢–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–æ—ë–≤:**
```
‚ö†Ô∏è  –¢–µ–≥ <map> –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ XML –±–æ—è 3769990
```

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±–æ–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `map_patch` –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç—ã.

---

**–í—ã–≤–æ–¥:** –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç—ã –Ω—É–∂–Ω–∞ **–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤** —Å —Å–µ—Ä–≤–µ—Ä–∞! üó∫Ô∏è





