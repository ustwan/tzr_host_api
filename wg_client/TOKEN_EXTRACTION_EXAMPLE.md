# üî§ –ö–∞–∫ —Å–∫—Ä–∏–ø—Ç –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∫–∞—Ä—Ç—ã

## üìã –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ XML —Å —Å–µ—Ä–≤–µ—Ä–∞

```python
# –ó–∞–ø—Ä–æ—Å –∫ API
url = f"http://localhost:8084/battle/{battle_id}/raw"
response = requests.get(url)
xml_content = response.content
```

---

### –®–∞–≥ 2: –ü–∞—Ä—Å–∏–Ω–≥ XML

```python
tree = ET.fromstring(xml_content)

# –ò—â–µ–º —Ç–µ–≥ <map>
map_elem = tree.find('.//map')

# –ò–∑–≤–ª–µ–∫–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã
width = int(map_elem.get('width', 0))
height = int(map_elem.get('height', 0))

# –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
data_elem = map_elem.find('data')
map_data = data_elem.text.strip()
```

**–ü—Ä–∏–º–µ—Ä XML:**
```xml
<map width="40" height="30">
  <data>
##########################################
#........................................#
#........................................#
#.......T...............................#
#......TTT..............................#
#.......T................W..............#
#..................W...W...W............#
#.................WWW.WWW...............#
#..................W...W................#
#......................................#
  </data>
</map>
```

---

### –®–∞–≥ 3: –†–∞–∑–±–∏–≤–∫–∞ –∫–∞—Ä—Ç—ã –Ω–∞ —Å—Ç—Ä–æ–∫–∏

```python
# 5. –†–∞–∑–±–∏–≤–∞–µ–º –∫–∞—Ä—Ç—É –Ω–∞ —Å—Ç—Ä–æ–∫–∏
map_rows = [line for line in map_data.split('\n') if line.strip()]

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# [
#   "##########################################",
#   "#........................................#",
#   "#........................................#",
#   "#.......T...............................#",
#   ...
# ]
```

---

### –®–∞–≥ 4: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤

```python
# 6. –ò–∑–≤–ª–µ–∫–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (—Å–∏–º–≤–æ–ª—ã)
tokens = set()
for row in map_rows:
    tokens.update(row)

# tokens = {'#', '.', 'T', 'W'}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `tokens.update(row)`:**
```python
# row = "###..T..W"
# tokens.update(row) –¥–æ–±–∞–≤–∏—Ç –≤—Å–µ —Å–∏–º–≤–æ–ª—ã: '#', '.', 'T', 'W'

# –ü—Ä–∏–º–µ—Ä –ø–æ—à–∞–≥–æ–≤–æ:
row = "###..T..W"
tokens = set()

for char in row:
    tokens.add(char)

# –ò—Ç–µ—Ä–∞—Ü–∏—è 1: char = '#' ‚Üí tokens = {'#'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 2: char = '#' ‚Üí tokens = {'#'} (–¥—É–±–ª–∏–∫–∞—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
# –ò—Ç–µ—Ä–∞—Ü–∏—è 3: char = '#' ‚Üí tokens = {'#'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 4: char = '.' ‚Üí tokens = {'#', '.'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 5: char = '.' ‚Üí tokens = {'#', '.'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 6: char = 'T' ‚Üí tokens = {'#', '.', 'T'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 7: char = '.' ‚Üí tokens = {'#', '.', 'T'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 8: char = '.' ‚Üí tokens = {'#', '.', 'T'}
# –ò—Ç–µ—Ä–∞—Ü–∏—è 9: char = 'W' ‚Üí tokens = {'#', '.', 'T', 'W'}
```

---

### –®–∞–≥ 5: –ü–æ–¥—Å—á–µ—Ç —á–∞—Å—Ç–æ—Ç—ã —Ç–æ–∫–µ–Ω–æ–≤

```python
# 7. –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—Ç–æ—Ç—É —Ç–æ–∫–µ–Ω–æ–≤
token_counts = {}
for row in map_rows:
    for char in row:
        token_counts[char] = token_counts.get(char, 0) + 1
```

**–ü—Ä–∏–º–µ—Ä:**
```python
# –ö–∞—Ä—Ç–∞ 40x30 = 1200 –∫–ª–µ—Ç–æ–∫
token_counts = {
    '#': 154,    # 12.8%  - —Å—Ç–µ–Ω—ã
    '.': 980,    # 81.7%  - –ø—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
    'T': 15,     # 1.25%  - –¥–µ—Ä–µ–≤—å—è
    'W': 51      # 4.25%  - –≤–æ–¥–∞
}
```

---

### –®–∞–≥ 6: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```python
return {
    "battle_id": battle_id,
    "width": 40,
    "height": 30,
    "actual_height": 30,
    "actual_width": 40,
    "map_data": map_rows,  # –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ –∫–∞—Ä—Ç—ã
    "tokens": ['#', '.', 'T', 'W'],  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
    "token_counts": {
        '#': 154,
        '.': 980,
        'T': 15,
        'W': 51
    },
    "total_cells": 1200
}
```

---

## üéØ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (XML):
```xml
<map width="5" height="3">
  <data>
#####
#.T.#
#####
  </data>
</map>
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞:

```python
# 1. map_data –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
"""
#####
#.T.#
#####
"""

# 2. map_rows –ø–æ—Å–ª–µ split:
["#####", "#.T.#", "#####"]

# 3. tokens –ø–æ—Å–ª–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è:
{'#', '.', 'T'}

# 4. token_counts –ø–æ—Å–ª–µ –ø–æ–¥—Å—á–µ—Ç–∞:
{
  '#': 11,  # (5 + 2 + 5)
  '.': 2,   # (1 + 1)
  'T': 1    # (1)
}
```

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

#### –†–µ–∂–∏–º `--tokens`:
```json
[
  "#",
  ".",
  "T"
]
```

#### –†–µ–∂–∏–º `--json`:
```json
{
  "battle_id": 12345,
  "width": 5,
  "height": 3,
  "tokens": ["#", ".", "T"],
  "token_counts": {
    "#": 11,
    ".": 2,
    "T": 1
  }
}
```

#### –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–≤–∏–∑—É–∞–ª—å–Ω—ã–π):
```
============================================================
üó∫Ô∏è  –ö–ê–†–¢–ê –ë–û–Ø #12345
============================================================

üìê –†–∞–∑–º–µ—Ä: 5x3 (–∑–∞—è–≤–ª–µ–Ω–Ω—ã–π)
üìê –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π: 5x3
üìä –í—Å–µ–≥–æ –∫–ª–µ—Ç–æ–∫: 15

üî§ –¢–û–ö–ï–ù–´ –ö–ê–†–¢–´ (3 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö):
  '#'            ‚Üí    11 –∫–ª–µ—Ç–æ–∫ (73.33%)
  '.'            ‚Üí     2 –∫–ª–µ—Ç–æ–∫ (13.33%)
  'T'            ‚Üí     1 –∫–ª–µ—Ç–æ–∫ ( 6.67%)

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìç –ö–ê–†–¢–ê:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  1 | #####
  2 | #.T.#
  3 | #####

============================================================
```

---

## üîç –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã Python

### `set.update(iterable)`
–î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ iterable –≤ set:
```python
tokens = set()
tokens.update("ABC")  # tokens = {'A', 'B', 'C'}
tokens.update("ADE")  # tokens = {'A', 'B', 'C', 'D', 'E'}
```

### `dict.get(key, default)`
–ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç default:
```python
counts = {'a': 5}
counts.get('a', 0)  # ‚Üí 5
counts.get('b', 0)  # ‚Üí 0 (–Ω–µ—Ç –∫–ª—é—á–∞ 'b')
```

### `sorted(list(set))`
–°–æ—Ä—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
```python
tokens = {'W', 'T', '#', '.'}
sorted(list(tokens))  # ‚Üí ['#', '.', 'T', 'W']
```

---

## üìä –¢–∏–ø–∏—á–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –≤ –∫–∞—Ä—Ç–∞—Ö

| –¢–æ–∫–µ–Ω | –ó–Ω–∞—á–µ–Ω–∏–µ | –ß–∞—Å—Ç–æ—Ç–∞ |
|-------|----------|---------|
| `#` | –°—Ç–µ–Ω–∞ | 10-20% |
| `.` | –ü—É—Å—Ç–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ | 60-80% |
| `T` | –î–µ—Ä–µ–≤–æ | 1-5% |
| `W` | –í–æ–¥–∞ | 2-10% |
| `~` | –ë–æ–ª–æ—Ç–æ | 1-3% |
| `^` | –ì–æ—Ä–∞ | 1-5% |
| `+` | –î–≤–µ—Ä—å | 0.1-1% |
| `=` | –ú–æ—Å—Ç | 0.1-1% |
| ` ` (–ø—Ä–æ–±–µ–ª) | –ü—Ä–æ—Ö–æ–¥ | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ |

---

## ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã
python3 get_battle_map.py 3769990 --tokens

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã —Å —á–∞—Å—Ç–æ—Ç–æ–π
python3 get_battle_map.py 3769990 --json

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
python3 get_battle_map.py 3769990
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

**–°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:**
1. –§–∞–π–ª –±–æ—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–≥ `<map>` —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫–∞—Ä—Ç—ã
2. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (—Ñ–æ—Ä–º–∞—Ç `<BLOOK>`) –∏—Å–ø–æ–ª—å–∑—É—é—Ç `map_patch` –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç—ã
3. –î–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω—É–∂–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∫–∞—Ä—Ç

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:**
```bash
head -5 /Users/ii/srv/btl/raw/75/3769990.tzb

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ <BLOOK> ‚Üí —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–Ω–µ—Ç –∫–∞—Ä—Ç—ã)
# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ <map> ‚Üí —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å—Ç—å –∫–∞—Ä—Ç–∞)
```

---

üéØ **–°–∫—Ä–∏–ø—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è –±–æ—ë–≤ —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º XML!**





