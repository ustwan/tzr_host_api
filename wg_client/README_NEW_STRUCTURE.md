# WG_HUB - –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Docker Compose

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ compose —Ñ–∞–π–ª–æ–≤

### üèóÔ∏è **HOST_API_SERVICE_INFRASTRUCTURE.yml**
- **traefik** :80 - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–∫—Å–∏
- **wg_vpn** - WireGuard VPN –∫–ª–∏–µ–Ω—Ç  
- **api_father_redis** :6379 - Redis –∫—ç—à

### üéØ **HOST_API_SERVICE_FATHER_API.yml**
- **api_father** :9000 - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π API

### ‚ö° **HOST_API_SERVICE_LIGHT_WEIGHT_API.yml**
- **api_1** :8081 - —Å—Ç–∞—Ç—É—Å –∏–≥—Ä–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
- **api_2** :8082 - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –±–æ–Ω—É—Å—ã

### üî• **HOST_API_SERVICE_HEAVY_WEIGHT_API.yml**
- **api_4** :8084 - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–æ—ë–≤

### üë∑ **HOST_API_SERVICE_WORKERS.yml**
- **worker** - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- **game_server_mock** :5190 - –º–æ–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### üóÑÔ∏è **HOST_API_SERVICE_DB_API.yml**
- **db** :3306 - MySQL —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î
- **api_4_db** :5432 - PostgreSQL –¥–ª—è API_4

### üìä **HOST_API_SERVICE_MONITORING.yml**
- **portainer** :9100 - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker
- **netdata** :9101 - –º–µ—Ç—Ä–∏–∫–∏ —Ö–æ—Å—Ç–∞
- **dozzle** :9102 - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- **uptime-kuma** :9103 - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–ø—Ç–∞–π–º–∞
- **homarr** :9104 - —Å—Ç–∞—Ä—Ç-—Å—Ç—Ä–∞–Ω–∏—Ü–∞
- **pgadmin** :9105 - PostgreSQL –∞–¥–º–∏–Ω
- **swagger-ui** :9107 - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **filebrowser** :9108 - —Ñ–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
- **ttyd** :9109 - –≤–µ–±-—Ç–µ—Ä–º–∏–Ω–∞–ª

### üóÉÔ∏è **HOST_API_SERVICE_DB_MONITORING.yml**
- **metabase-db** :5433 - PostgreSQL –¥–ª—è Metabase
- **metabase** :9106 - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –¥–∞—à–±–æ—Ä–¥—ã

### üõ†Ô∏è **HOST_API_SERVICE_UTILITIES.yml**
- **migrator** - –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –ë–î

## üöÄ –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + API + –≤–æ—Ä–∫–µ—Ä—ã)
bash tools/ctl.sh up

# –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–≤–∫–ª—é—á–∞—è API_4 –∏ –ë–î)
bash tools/ctl.sh up-full

# –° —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
bash tools/ctl.sh up-testdb

# –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
bash tools/ctl.sh up-monitoring
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- Unit/Smoke: `pytest -q` (—Å–º. `HOST_API_SERVICE/pytest.ini`)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ (–ª–æ–∫–∞–ª—å–Ω–æ): –ø–æ–¥–Ω–∏–º–∏—Ç–µ –Ω—É–∂–Ω—ã–µ —Å—Ç–µ–∫–∏ –∫–æ–º–∞–Ω–¥–æ–π `tools/ctl.sh config|ps` (–±–µ–∑ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤), –∑–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–π—Ç–µ TestClient‚Äë—Ç–µ—Å—Ç—ã.

## üìö Clean Architecture –≥–∞–π–¥

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ —Å–ª–æ—ë–≤: —Å–º. —Ñ–∞–π–ª `CLEAN_ARCHITECTURE.md` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª —Å–ª–æ—ë–≤: `python tools/layer_lint.py` (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–Ω—É–ª–µ–≤–æ–π –∫–æ–¥ –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö –∏–º–ø–æ—Ä—Ç–æ–≤)

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
bash tools/ctl.sh down

# –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
bash tools/ctl.sh down-full

# –í—Å–µ + —É–¥–∞–ª–µ–Ω–∏–µ volumes
bash tools/ctl.sh down-all

# –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
bash tools/ctl.sh down-monitoring
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
bash tools/ctl.sh restart-api1      # API_1
bash tools/ctl.sh restart-api2      # API_2  
bash tools/ctl.sh restart-api4      # API_4
bash tools/ctl.sh restart-father    # API_FATHER
```

### –õ–æ–≥–∏
```bash
bash tools/ctl.sh logs              # –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
bash tools/ctl.sh logs-full         # –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
bash tools/ctl.sh logs-monitoring   # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
```bash
bash tools/ctl.sh infrastructure    # –¢–æ–ª—å–∫–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
bash tools/ctl.sh father           # –¢–æ–ª—å–∫–æ API_FATHER
bash tools/ctl.sh lightweight      # –¢–æ–ª—å–∫–æ –ª–µ–≥–∫–∏–µ API
bash tools/ctl.sh heavyweight      # –¢–æ–ª—å–∫–æ API_4
bash tools/ctl.sh workers          # –¢–æ–ª—å–∫–æ –≤–æ—Ä–∫–µ—Ä—ã
bash tools/ctl.sh db               # –¢–æ–ª—å–∫–æ –ë–î
bash tools/ctl.sh monitoring       # –¢–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### ‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**
- –ö–∞–∂–¥—ã–π compose —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤

### ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**
- –†–∞–∑–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
- –õ–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ò–∑–æ–ª—è—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### ‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ**
- –ü–æ–Ω—è—Ç–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- –õ–æ–≥–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–°—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã ‚Üí –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ë—ã–ª–æ
docker compose -f compose.base.yml -f compose.apis.yml up
# –°—Ç–∞–ª–æ  
bash tools/ctl.sh up

# –ë—ã–ª–æ
docker compose -f compose.base.yml -f compose.apis.yml -f compose.db.test.yml up
# –°—Ç–∞–ª–æ
bash tools/ctl.sh up-testdb

# –ë—ã–ª–æ
docker compose -f compose.monitoring.yml up
# –°—Ç–∞–ª–æ
bash tools/ctl.sh up-monitoring
```
