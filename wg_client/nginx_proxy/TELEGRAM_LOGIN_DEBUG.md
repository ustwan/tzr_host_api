# üîç –û—Ç–ª–∞–¥–∫–∞ Telegram Login

> –ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram –∏ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

## üêõ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram
3. –û–∫–Ω–æ **—Å—Ä–∞–∑—É –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è**
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞ —Ç—É –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∫–Ω–æ–ø–∫–æ–π
5. **–§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è**

---

## üîÑ –ö–∞–∫ –î–û–õ–ñ–ï–ù —Ä–∞–±–æ—Ç–∞—Ç—å Telegram Login

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π flow:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
   ‚Üì
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è popup/redirect –Ω–∞ oauth.telegram.org
   ‚Üì
3. Telegram –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
   ‚Ä¢ –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Telegram ‚Üí —Å—Ä–∞–∑—É callback
   ‚Ä¢ –ï—Å–ª–∏ –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø—Ä–æ—Å–∏—Ç –≤–æ–π—Ç–∏
   ‚Üì
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø (–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   ‚Üì
5. Telegram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–∞—à —Å–∞–π—Ç:
   ‚Ä¢ id (telegram_id)
   ‚Ä¢ first_name
   ‚Ä¢ last_name
   ‚Ä¢ username
   ‚Ä¢ photo_url
   ‚Ä¢ auth_date
   ‚Ä¢ hash (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏)
   ‚Üì
6. –°–∞–π—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç telegram_id –≤ localStorage/sessionStorage
   ‚Üì
7. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:
   ‚Ä¢ –õ–æ–≥–∏–Ω (input)
   ‚Ä¢ –ü–∞—Ä–æ–ª—å (input)
   ‚Ä¢ –ü–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (select)
   ‚Ä¢ telegram_id (—Å–∫—Ä—ã—Ç, –∏–∑ localStorage)
   ‚Ä¢ username (—Å–∫—Ä—ã—Ç, –∏–∑ Telegram –¥–∞–Ω–Ω—ã—Ö)
   ‚Üì
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç
   ‚Üì
9. –ó–∞–ø—Ä–æ—Å –Ω–∞ API: POST /api/register
```

---

## ‚ùå –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π callback URL**

Telegram Login Widget —Ç—Ä–µ–±—É–µ—Ç **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–æ–º–µ–Ω** –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞.

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// –ï—Å–ª–∏ —Å–∞–π—Ç –Ω–∞ ngrok:
// https://abc123.ngrok-free.app

// –ê –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞ —É–∫–∞–∑–∞–Ω:
// https://yoursite.com
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–º–µ–Ω —á–µ—Ä–µ–∑ @BotFather
/setdomain
# –£–∫–∞–∑–∞—Ç—å: abc123.ngrok-free.app
```

---

### 2. **Popup –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º**

–ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å popup –æ–∫–Ω–æ Telegram.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Console
- –ò—â–∏—Ç–µ: `"Popup blocked"` –∏–ª–∏ `"Popup window was blocked"`

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –í–º–µ—Å—Ç–æ popup –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ redirect
<script>
  function telegramLogin() {
    // Redirect –≤–º–µ—Å—Ç–æ popup
    window.location.href = `https://oauth.telegram.org/auth?bot_id=YOUR_BOT_ID&origin=${window.location.origin}&request_access=write&return_to=${window.location.href}`;
  }
</script>
```

---

### 3. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ callback**

–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –Ω–æ —Å–∞–π—Ç –∏—Ö –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
// Telegram –≤–µ—Ä–Ω—É–ª –¥–∞–Ω–Ω—ã–µ –≤ URL:
// https://yoursite.com/#id=312660736&first_name=John...

// –ù–æ –ù–ï–¢ –∫–æ–¥–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö!
```

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º URL hash
window.addEventListener('load', () => {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  
  if (params.has('id')) {
    const telegramData = {
      id: params.get('id'),
      first_name: params.get('first_name'),
      last_name: params.get('last_name'),
      username: params.get('username'),
      photo_url: params.get('photo_url'),
      auth_date: params.get('auth_date'),
      hash: params.get('hash')
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
    localStorage.setItem('telegram_user', JSON.stringify(telegramData));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    showRegistrationForm(telegramData);
    
    // –û—á–∏—â–∞–µ–º hash –∏–∑ URL
    window.history.replaceState(null, null, window.location.pathname);
  }
});

function showRegistrationForm(telegramData) {
  // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
  document.getElementById('telegram-login-btn').style.display = 'none';
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
  document.getElementById('registration-form').style.display = 'block';
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
  document.getElementById('telegram_id').value = telegramData.id;
  document.getElementById('telegram_username').value = telegramData.username || '';
}
```

---

### 4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Telegram Login Widget, –Ω–æ –Ω–µ—Ç data-onauth**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```html
<!-- Widget –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ -->
<script 
  async 
  src="https://telegram.org/js/telegram-widget.js?22" 
  data-telegram-login="YOUR_BOT_USERNAME" 
  data-size="large" 
  data-request-access="write">
</script>
<!-- –ù–ï–¢ data-onauth! -->
```

**–†–µ—à–µ–Ω–∏–µ:**
```html
<!-- –° –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º -->
<script 
  async 
  src="https://telegram.org/js/telegram-widget.js?22" 
  data-telegram-login="YOUR_BOT_USERNAME" 
  data-size="large" 
  data-onauth="onTelegramAuth(user)"
  data-request-access="write">
</script>

<script>
  function onTelegramAuth(user) {
    console.log('Telegram user:', user);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
    localStorage.setItem('telegram_user', JSON.stringify(user));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    showRegistrationForm(user);
  }
  
  function showRegistrationForm(user) {
    // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É Telegram
    document.getElementById('telegram-section').style.display = 'none';
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É
    document.getElementById('registration-form').style.display = 'block';
    
    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª—è
    document.getElementById('telegram_id').value = user.id;
    document.getElementById('telegram_username').value = user.username || '';
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    document.getElementById('user-greeting').textContent = 
      `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}! –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:`;
  }
</script>
```

---

### 5. **CSP (Content Security Policy) –±–ª–æ–∫–∏—Ä—É–µ—Ç iframe**

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
Content-Security-Policy: frame-src 'self'
// –ë–ª–æ–∫–∏—Ä—É–µ—Ç iframe –æ—Ç telegram.org
```

**–†–µ—à–µ–Ω–∏–µ:**
```html
<meta http-equiv="Content-Security-Policy" 
      content="frame-src 'self' https://oauth.telegram.org;">
```

---

## üß™ –û—Ç–ª–∞–¥–∫–∞

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ DevTools

```
F12 ‚Üí Console
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏

–ò—â–∏—Ç–µ:
- ‚ùå `"Popup blocked"`
- ‚ùå `"CSP violation"`
- ‚ùå `"Refused to frame"`
- ‚ùå `"onTelegramAuth is not defined"`
- ‚ùå `"hash validation failed"`

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network

```
F12 ‚Üí Network ‚Üí —Ñ–∏–ª—å—Ç—Ä: oauth.telegram.org
```

–°–º–æ—Ç—Ä–∏—Ç–µ:
- ‚úÖ –ó–∞–ø—Ä–æ—Å –Ω–∞ `oauth.telegram.org` —É—Å–ø–µ—à–µ–Ω (200)
- ‚úÖ –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Redirect –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –≤–∞—à —Å–∞–π—Ç

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage

```javascript
// –í Console:
localStorage.getItem('telegram_user')

// –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
// {"id":312660736,"first_name":"John",...}

// –ï—Å–ª–∏ null - –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å!
```

### –®–∞–≥ 5: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```javascript
// –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏ –≤–µ–∑–¥–µ
window.addEventListener('load', () => {
  console.log('Page loaded');
  console.log('Hash:', window.location.hash);
  console.log('localStorage:', localStorage.getItem('telegram_user'));
});

function onTelegramAuth(user) {
  console.log('onTelegramAuth called!');
  console.log('User data:', user);
  console.log('Telegram ID:', user.id);
}
```

---

## ‚úÖ –†–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä (–ø–æ–ª–Ω—ã–π –∫–æ–¥)

### HTML:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
</head>
<body>

<!-- –°–µ–∫—Ü–∏—è 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram -->
<div id="telegram-section">
  <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</h1>
  <p>–ú—ã –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ email.</p>
  <p>–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram.</p>
  <p>–í–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –±—É–¥—É—Ç –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É Telegram.</p>
  <p>–≠—Ç–æ –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.</p>
  
  <!-- Telegram Login Widget -->
  <script 
    async 
    src="https://telegram.org/js/telegram-widget.js?22" 
    data-telegram-login="tzr_ernest_bot"
    data-size="large" 
    data-onauth="onTelegramAuth(user)"
    data-request-access="write">
  </script>
  
  <p>–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –∏–≥—Ä—ã</p>
</div>

<!-- –°–µ–∫—Ü–∏—è 2: –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
<div id="registration-form" style="display: none;">
  <h2 id="user-greeting">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</h2>
  
  <form id="character-form">
    <div>
      <label>–õ–æ–≥–∏–Ω (3-16 —Å–∏–º–≤–æ–ª–æ–≤):</label>
      <input type="text" id="login" required minlength="3" maxlength="16">
    </div>
    
    <div>
      <label>–ü–∞—Ä–æ–ª—å (6-20 —Å–∏–º–≤–æ–ª–æ–≤):</label>
      <input type="password" id="password" required minlength="6" maxlength="20">
    </div>
    
    <div>
      <label>–ü–æ–ª –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:</label>
      <select id="gender" required>
        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
        <option value="0">–ú—É–∂—Å–∫–æ–π</option>
        <option value="1">–ñ–µ–Ω—Å–∫–∏–π</option>
      </select>
    </div>
    
    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è -->
    <input type="hidden" id="telegram_id">
    <input type="hidden" id="telegram_username">
    
    <button type="submit">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</button>
  </form>
  
  <div id="result"></div>
</div>

<script>
  // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
  const API_CONFIG = {
    baseUrl: 'http://localhost:8090',  // –ò–ª–∏ ngrok URL
    apiKey: 'dev_api_key_12345'
  };

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  function onTelegramAuth(user) {
    console.log('‚úÖ Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
    console.log('User data:', user);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    localStorage.setItem('telegram_user', JSON.stringify(user));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    showRegistrationForm(user);
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  function showRegistrationForm(user) {
    // –°–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é Telegram
    document.getElementById('telegram-section').style.display = 'none';
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É
    document.getElementById('registration-form').style.display = 'block';
    
    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è
    document.getElementById('telegram_id').value = user.id;
    document.getElementById('telegram_username').value = user.username || 'unknown';
    
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    document.getElementById('user-greeting').textContent = 
      `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}! –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞:`;
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  document.getElementById('character-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞...';
    
    const formData = {
      login: document.getElementById('login').value.trim(),
      password: document.getElementById('password').value,
      gender: parseInt(document.getElementById('gender').value),
      telegram_id: parseInt(document.getElementById('telegram_id').value),
      username: document.getElementById('telegram_username').value
    };
    
    console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:', formData);
    
    try {
      const response = await fetch(`${API_CONFIG.baseUrl}/api/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-API-Key': API_CONFIG.apiKey
        },
        body: JSON.stringify(formData)
      });
      
      const data = await response.json();
      
      if (response.ok) {
        resultDiv.innerHTML = `<span style="color: green;">‚úÖ ${data.message}</span>`;
        document.getElementById('character-form').reset();
      } else {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        let errorMsg = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
        
        switch (data.detail) {
          case 'limit_exceeded':
            errorMsg = '–£ –≤–∞—Å —É–∂–µ 5 –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π. –≠—Ç–æ –º–∞–∫—Å–∏–º—É–º.';
            break;
          case 'login_taken':
            errorMsg = '–≠—Ç–æ—Ç –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π.';
            break;
          case 'not_in_telegram_group':
            errorMsg = '–í—Å—Ç—É–ø–∏—Ç–µ –≤ Telegram –≥—Ä—É–ø–ø—É –∏–≥—Ä—ã.';
            break;
          default:
            errorMsg = data.message || data.detail || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
        }
        
        resultDiv.innerHTML = `<span style="color: red;">‚ùå ${errorMsg}</span>`;
      }
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞:', error);
      resultDiv.innerHTML = '<span style="color: red;">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</span>';
    }
  });

  // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  window.addEventListener('load', () => {
    const savedUser = localStorage.getItem('telegram_user');
    
    if (savedUser) {
      console.log('–ù–∞–π–¥–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Telegram');
      const user = JSON.parse(savedUser);
      showRegistrationForm(user);
    }
  });
</script>

</body>
</html>
```

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ï—Å–ª–∏ popup –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è:

```javascript
// –ó–∞–º–µ–Ω–∏—Ç–µ widget –Ω–∞ –∫–Ω–æ–ø–∫—É —Å redirect
<button onclick="loginWithTelegram()">
  –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
</button>

<script>
  function loginWithTelegram() {
    const botUsername = 'tzr_ernest_bot';
    const currentUrl = window.location.href;
    window.location.href = `https://oauth.telegram.org/auth?bot_id=8303561821&origin=${window.location.origin}&embed=1&request_access=write&return_to=${encodeURIComponent(currentUrl)}`;
  }
</script>
```

### –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞
console.log('localStorage –¥–æ—Å—Ç—É–ø–µ–Ω?', typeof(Storage) !== "undefined");
console.log('–î–∞–Ω–Ω—ã–µ:', localStorage.getItem('telegram_user'));

// –û—á–∏—Å—Ç–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ)
localStorage.removeItem('telegram_user');
```

---

## üìû –ß–µ–∫-–ª–∏—Å—Ç –æ—Ç–ª–∞–¥–∫–∏

- [ ] –û—Ç–∫—Ä—ã–ª DevTools ‚Üí Console
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- [ ] Telegram widget –∑–∞–≥—Ä—É–∂–µ–Ω (iframe –≤–∏–¥–µ–Ω)
- [ ] Popup –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º
- [ ] –§—É–Ω–∫—Ü–∏—è `onTelegramAuth` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
- [ ] –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `onTelegramAuth`
- [ ] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `localStorage`
- [ ] –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
- [ ] `telegram_id` –∑–∞–ø–æ–ª–Ω–µ–Ω –≤ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã:

1. **Console (F12)** - –≤—Å–µ –æ—à–∏–±–∫–∏
2. **Network (F12)** - –∑–∞–ø—Ä–æ—Å –Ω–∞ `oauth.telegram.org`
3. **Application ‚Üí LocalStorage** - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
4. **HTML –∫–æ–¥** —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å —Ñ–æ—Ä–º–æ–π

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É!

---

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [Telegram Login Widget](https://core.telegram.org/widgets/login)
- [API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏](REGISTRATION_API_SPEC.md)
- [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](ERROR_MESSAGES_FOR_SITE.md)



