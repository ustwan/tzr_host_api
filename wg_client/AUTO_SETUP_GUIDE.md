# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WG_HUB

## üìã –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### ‚úÖ –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î**
   - API 4 –∂–¥—ë—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î (–º–∞–∫—Å 60 —Å–µ–∫)
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `migrations/`
   - –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

2. **XML Sync –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `auto-continue`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –±–æ–∏ —á–µ—Ä–µ–∑ XML Workers
   - –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç API)

3. **Swagger UI —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏**
   - Authorization token –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω
   - Try it out –≤–∫–ª—é—á—ë–Ω
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞–º–∏

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### XML Sync (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ API 4)

```bash
# –†–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: xml / file / both
SYNC_MODE=xml

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ XML sync –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
ENABLE_XML_SYNC_ON_START=true

# –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ –¥–ª—è auto-continue
XML_SYNC_BATCH_SIZE=1000

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ sync (0 = –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ)
XML_SYNC_INTERVAL=0

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
AUTO_APPLY_MIGRATIONS=true
```

### Swagger UI (–≤ MONITORING compose)

```bash
# Persistent authorization
PERSIST_AUTHORIZATION=true

# Config file
CONFIG_URL=/swagger-config.json
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (—Å –Ω—É–ª—è)

```bash
cd wg_client

# 1. –ó–∞–ø—É—Å–∫ XML Workers
docker-compose -f HOST_API_SERVICE_XML_WORKERS.yml up -d

# 2. –ó–∞–ø—É—Å–∫ API 4 (–ø—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
docker-compose -f HOST_API_SERVICE_HEAVY_WEIGHT_API.yml up -d

# 3. –ó–∞–ø—É—Å–∫ Swagger UI (—Å persistent –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏)
docker-compose -f HOST_API_SERVICE_MONITORING_SIMPLE.yml up -d swagger-ui
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ë–î —Å–æ–∑–¥–∞–Ω–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- ‚úÖ XML Sync –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –±–æ–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ Swagger UI —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

### –ò–ª–∏ —á–µ—Ä–µ–∑ ctl.sh

```bash
cd wg_client
./tools/ctl.sh start-all
```

---

## üìä –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ API 4

```
1. Entrypoint.sh
   ‚îú‚îÄ –ñ–¥—ë—Ç –ë–î (60 —Å–µ–∫)
   ‚îú‚îÄ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
   ‚îî‚îÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç uvicorn

2. Startup Event (main.py)
   ‚îú‚îÄ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î
   ‚îú‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–∏—Å—ã
   ‚îú‚îÄ –õ–æ–≥–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
   ‚îî‚îÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç XML Sync –≤ —Ñ–æ–Ω–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω)

3. XML Sync (—Ñ–æ–Ω)
   ‚îú‚îÄ –ñ–¥—ë—Ç 5 —Å–µ–∫
   ‚îú‚îÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç auto-continue
   ‚îî‚îÄ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –±–æ–∏
```

---

## üîÑ –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏

### Docker Compose Down + Up

```bash
docker-compose -f HOST_API_SERVICE_HEAVY_WEIGHT_API.yml down
docker-compose -f HOST_API_SERVICE_HEAVY_WEIGHT_API.yml up -d
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è (idempotent, –±–µ–∑–æ–ø–∞—Å–Ω–æ)
2. ‚úÖ XML Sync –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ ID
3. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (env vars –≤ compose)
4. ‚úÖ Swagger UI —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (volume)

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (Down —Å --volumes)

```bash
docker-compose -f HOST_API_SERVICE_HEAVY_WEIGHT_API.yml down --volumes
docker-compose -f HOST_API_SERVICE_HEAVY_WEIGHT_API.yml up -d
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –ë–î —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–Ω–æ–≤–æ
2. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. ‚úÖ XML Sync –Ω–∞—á–∏–Ω–∞–µ—Ç —Å ID 1475356
4. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ env vars

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### –û—Ç–∫–ª—é—á–∏—Ç—å XML Sync –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

```yaml
# –í HOST_API_SERVICE_HEAVY_WEIGHT_API.yml
environment:
  - ENABLE_XML_SYNC_ON_START=false
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å file upload –≤–º–µ—Å—Ç–æ XML

```yaml
environment:
  - SYNC_MODE=file
  - ENABLE_XML_SYNC_ON_START=false
```

### –û–±–∞ —Ä–µ–∂–∏–º–∞ –¥–æ—Å—Ç—É–ø–Ω—ã

```yaml
environment:
  - SYNC_MODE=both
  - ENABLE_XML_SYNC_ON_START=false  # –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API 4

```bash
docker logs wg-client-api_4-1 2>&1 | grep "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:"
```

–í—ã–≤–æ–¥:
```
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: {'sync_mode': 'xml', 'xml_sync_on_start': True, ...}
```

### XML Sync —Å—Ç–∞—Ç—É—Å

```bash
curl http://localhost:8084/admin/xml-sync/status
```

### Swagger UI

–û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:9107
- ‚úÖ Authorization –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ Try it out –≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

---

## üìù –õ–æ–≥–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
docker logs wg-client-api_4-1 2>&1 | grep -A 10 "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π"
```

### XML Sync

```bash
docker logs wg-client-api_4-1 2>&1 | grep "XML Sync"
```

### XML Workers

```bash
docker logs host-api-xml-worker-1
```

---

## üéØ –ò—Ç–æ–≥

**–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ª—é–±–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ XML Sync –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–∞–∑—É
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ Swagger UI –ø—Ä–µ–¥–ΩÔøΩÔøΩ—Å—Ç—Ä–æ–µ–Ω

**–ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!** üéâ




