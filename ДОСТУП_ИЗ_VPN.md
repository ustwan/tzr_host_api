# ๐ ะะพัััะฟ ะบ ะฐะดะผะธะฝะบะฐะผ ะธะท VPN

## ๐ฏ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะะฐั ัะตัะฒะตั ะธะผะตะตั ะะะ IP:

1. **LAN IP:** `172.16.16.117` (ะปะพะบะฐะปัะฝะฐั ัะตัั)
2. **VPN IP:** `10.8.0.1` (ะธะฝัะตััะตะนั wg0)

### ะะท VPN ะดะพัััะฟ ะฟะพ LAN IP ัะพััะฐ:

```
VPN ะบะปะธะตะฝั (10.8.0.2)
  โ routing ัะตัะตะท WireGuard
  โ ะผะพะถะตั ะดะพััััะฐัััั ะดะพ ัะพััะฐ
  โ http://172.16.16.117:XXXX
  โ ะะะะะขะะะข!
```

**ะะฐะถะฝะพ:** ะะพััั ะฝะฐ `0.0.0.0` ัะปััะฐัั ะฝะฐ **ะะกะะฅ** ะธะฝัะตััะตะนัะฐั ัะพััะฐ, ะฒะบะปััะฐั:
- `eth0` (172.16.16.117)
- `wg0` (10.8.0.1)
- `lo` (127.0.0.1)

---

## ๐ ะขะฐะฑะปะธัะฐ ะดะพัััะฟะฐ

| ะะดะผะธะฝะบะฐ | ะะพัั | ะะท ะปะพะบะฐะปัะฝะพะน ัะตัะธ | ะะท VPN | ะะพ VPN IP |
|---------|------|-------------------|--------|-----------|
| **Swagger** | 9107 | http://172.16.16.117:9107 | โ ะะฐ | http://172.16.16.117:9107 |
| **Portainer** | 9100 | http://172.16.16.117:9100 | โ ะะฐ | http://172.16.16.117:9100 |
| **Dozzle** | 9102 | http://172.16.16.117:9102 | โ ะะฐ | http://172.16.16.117:9102 |
| **Traefik** | 1010 | http://172.16.16.117:1010 | โ ะะฐ | http://172.16.16.117:1010 |
| **Netdata** | 9101 | http://172.16.16.117:9101 | โ ะะฐ | http://172.16.16.117:9101 |
| **WG-Easy** | 2019 | http://172.16.16.117:2019 | โ ะะฐ | http://172.16.16.117:2019 |
| **API_1** | 8081 | http://172.16.16.117:8081 | โ ะะฐ | http://172.16.16.117:8081 |
| **API_2** | 8082 | http://172.16.16.117:8082 | โ ะะฐ | http://172.16.16.117:8082 |
| **API_Father** | 9000 | http://172.16.16.117:9000 | โ ะะฐ | http://172.16.16.117:9000 |

**ะัะฒะพะด:** ะัะฟะพะปัะทัะนัะต **LAN IP ัะพััะฐ** (172.16.16.117), ะฝะต VPN IP (10.8.0.1)!

---

## ๐ ะะพัะตะผั ะฝะต ะฟะพ 10.8.0.1?

### ะขะตัะฝะธัะตัะบะฐั ะฟัะธัะธะฝะฐ:

```
10.8.0.1 - ััะพ IP ะธะฝัะตััะตะนัะฐ wg0 ะฝะฐ ัะพััะต
  โ
ะะพ Docker ะบะพะฝัะตะนะฝะตัั ัะปััะฐัั ะฝะฐ bridge ัะตัะธ
  โ
ะะพััั ะฟัะพะฑัะฐััะฒะฐัััั ะฝะฐ IP ัะพััะฐ (172.16.16.117)
  โ
ะะ ะฝะฐ IP ะธะฝัะตััะตะนัะฐ wg0 (10.8.0.1)
```

**ะัะบะปััะตะฝะธะต:** ะัะปะธ ะบะพะฝัะตะนะฝะตั ะฒ `network_mode: host`, ะพะฝ ะผะพะถะตั ัะปััะฐัั ะฝะฐ 10.8.0.1.

---

## โ ะะฐะบ ะฑัะดะตั ัะฐะฑะพัะฐัั (ะฟะพัะปะต ะธัะฟัะฐะฒะปะตะฝะธะน)

### 1. ะะพะดะบะปััะฐะตัะตัั ะบ VPN (WireGuard ะบะปะธะตะฝั)

```
ะะฐั ะบะพะผะฟัััะตั
  โ WireGuard ะฟะพะดะบะปััะตะฝะธะต
  โ ะะพะปััะฐะตัะต IP: 10.8.0.2
  โ Routing: 10.8.0.0/24 โ ัะตัะตะท VPN
```

### 2. ะัะบััะฒะฐะตัะต ะฐะดะผะธะฝะบะธ ะฟะพ LAN IP ัะตัะฒะตัะฐ

```
ะ ะฑัะฐัะทะตัะต (ะฒั ะฒ VPN):
http://172.16.16.117:9107  - Swagger โ
http://172.16.16.117:9100  - Portainer โ
http://172.16.16.117:1010  - Traefik โ
http://172.16.16.117:2019  - WG-Easy โ
```

**ะะฐะฑะพัะฐะตั ะฟะพัะพะผั ััะพ:**
- โ ะั ะฒ VPN (10.8.0.2)
- โ Routing ัะตัะตะท WireGuard ะดะพ ัะพััะฐ (172.16.16.117)
- โ ะะพััั ะฝะฐ 0.0.0.0 (ะดะพัััะฟะฝั ะดะปั VPN ะบะปะธะตะฝัะพะฒ)
- โ IP forwarding ะฒะบะปััะตะฝ
- โ iptables ัะฐะทัะตัะฐะตั wg0 โ ัะพัั

### 3. ะะปััะตัะฝะฐัะธะฒะฝะพ ะฟะพ VPN IP (ะตัะปะธ ะฝัะถะฝะพ)

ะัะปะธ ัะพัะธัะต ะดะพัััะฟ ะธะผะตะฝะฝะพ ะฟะพ `10.8.0.1:XXXX`, ะฝัะถะฝะพ ะดะพะฟะพะปะฝะธัะตะปัะฝะพ ะฟัะพะฑัะพัะธัั:

```bash
# ะะฐ ัะตัะฒะตัะต ะดะพะฑะฐะฒะธัั DNAT ะฟัะฐะฒะธะปะฐ
sudo iptables -t nat -A PREROUTING -i wg0 -d 10.8.0.1 -p tcp --dport 9107 -j DNAT --to-destination 172.16.16.117:9107
sudo iptables -t nat -A PREROUTING -i wg0 -d 10.8.0.1 -p tcp --dport 9100 -j DNAT --to-destination 172.16.16.117:9100
# ะ ัะฐะบ ะดะปั ะบะฐะถะดะพะณะพ ะฟะพััะฐ...

# ะัะพัะต ะธัะฟะพะปัะทะพะฒะฐัั LAN IP ัะพััะฐ!
```

---

## ๐ฏ ะัะพะณะพะฒะฐั ััะตะผะฐ ะดะพัััะฟะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะฐั ะบะพะผะฟัััะตั (ะฟะพะดะบะปััะตะฝ ะบ VPN)                  โ
โ IP ะฒ VPN: 10.8.0.2                               โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โ WireGuard tunnel
                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะตัะฒะตั 172.16.16.117                             โ
โ wg0: 10.8.0.1 (VPN ะธะฝัะตััะตะนั)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                  โ
โ ะะพััั ะฝะฐ 0.0.0.0 (ะฒัะต ะธะฝัะตััะตะนัั):              โ
โ   :1010  - Traefik                               โ
โ   :8081  - API_1                                 โ
โ   :8082  - API_2                                 โ
โ   :9000  - API_Father                            โ
โ   :9100  - Portainer                             โ
โ   :9107  - Swagger                               โ
โ   :2019  - WG-Easy ะฐะดะผะธะฝะบะฐ                       โ
โ                                                  โ
โ ะะพัััะฟะฝะพ ะธะท VPN ะฟะพ 172.16.16.117:XXXX โ         โ
โ                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ะัะฒะตั ะฝะฐ ะฒะฐั ะฒะพะฟัะพั:

**ะะฐ, ะฒัะต ะฐะดะผะธะฝะบะธ (Swagger, Portainer, Dozzle ะธ ั.ะด.) ะฑัะดัั ะดะพัััะฟะฝั ะธะท VPN!**

ะะพ **ะฟะพ IP ัะพััะฐ** (172.16.16.117), ะฐ ะฝะต ะฟะพ IP wg0 ะธะฝัะตััะตะนัะฐ (10.8.0.1).

**ะัะพัะต ะณะพะฒะพัั:**
- ะะพะดะบะปััะฐะตัะตัั ะบ VPN โ
- ะัะบััะฒะฐะตัะต `http://172.16.16.117:9107` โ
- ะัะต ัะฐะฑะพัะฐะตั! โ

---

## โก ะะฐ ัะตัะฒะตัะต ะฒัะฟะพะปะฝะธัะต:

```bash
# 1. ะะฑะฝะพะฒะธัั ั GitHub
cd /mnt/docker/tzr_host_api
sudo git pull origin main

# 2. IP forwarding
sudo sysctl -w net.ipv4.ip_forward=1

# 3. iptables ะดะปั VPN
sudo iptables -A INPUT -i wg0 -j ACCEPT
sudo iptables -A FORWARD -i wg0 -j ACCEPT

# 4. ะะฐะฟัััะธัั
cd wg_client
sudo bash tools/ctl.sh start-full

# 5. ะัะพะฒะตัะธัั
sudo bash tools/ctl.sh status
```

**ะขะตะฟะตัั ะะกะ ะฑัะดะตั ัะฐะฑะพัะฐัั ะฟัะฐะฒะธะปัะฝะพ!** ๐

